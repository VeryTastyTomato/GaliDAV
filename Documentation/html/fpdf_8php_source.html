<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>GaliDAV:  Fichier source de /home/user/Ãcole/Cours/Conduite et gestion de projet/GaliDAV/php2pdf/fpdf.php</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">GaliDAV
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Généré par Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Recherche');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Page&#160;principale</span></a></li>
      <li><a href="annotated.html"><span>Structures&#160;de&#160;données</span></a></li>
      <li class="current"><a href="files.html"><span>Fichiers</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Recherche" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>Liste&#160;des&#160;fichiers</span></a></li>
      <li><a href="globals.html"><span>Variables&#160;globale</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">/home/user/École/Cours/Conduite et gestion de projet/GaliDAV/php2pdf/fpdf.php</div>  </div>
</div><!--header-->
<div class="contents">
<a href="fpdf_8php.html">Aller à la documentation de ce fichier.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 <span class="comment">/*******************************************************************************</span>
<a name="l00003"></a>00003 <span class="comment">* Logiciel : FPDF                                                              *</span>
<a name="l00004"></a>00004 <span class="comment">* Version :  1.53                                                              *</span>
<a name="l00005"></a>00005 <span class="comment">* Date :     31/12/2004                                                        *</span>
<a name="l00006"></a>00006 <span class="comment">* Auteur :   Olivier PLATHEY                                                   *</span>
<a name="l00007"></a>00007 <span class="comment">* Licence :  Freeware                                                          *</span>
<a name="l00008"></a>00008 <span class="comment">*                                                                              *</span>
<a name="l00009"></a>00009 <span class="comment">* Vous pouvez utiliser et modifier ce logiciel comme vous le souhaitez.        *</span>
<a name="l00010"></a>00010 <span class="comment">*******************************************************************************/</span>
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="keywordflow">if</span>(!class_exists(<span class="stringliteral">&#39;FPDF&#39;</span>))
<a name="l00013"></a>00013 {
<a name="l00014"></a>00014 define(<span class="stringliteral">&#39;FPDF_VERSION&#39;</span>,<span class="stringliteral">&#39;1.53&#39;</span>);
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="keyword">class </span>FPDF
<a name="l00017"></a>00017 {
<a name="l00018"></a>00018 <span class="comment">//Private properties</span>
<a name="l00019"></a>00019 var $page;               <span class="comment">//current page number</span>
<a name="l00020"></a>00020 var $n;                  <span class="comment">//current object number</span>
<a name="l00021"></a>00021 var $offsets;            <span class="comment">//array of object offsets</span>
<a name="l00022"></a>00022 var $buffer;             <span class="comment">//buffer holding in-memory PDF</span>
<a name="l00023"></a>00023 var $pages;              <span class="comment">//array containing pages</span>
<a name="l00024"></a>00024 var $state;              <span class="comment">//current document state</span>
<a name="l00025"></a>00025 var $compress;           <span class="comment">//compression flag</span>
<a name="l00026"></a>00026 var $DefOrientation;     <span class="comment">//default orientation</span>
<a name="l00027"></a>00027 var $CurOrientation;     <span class="comment">//current orientation</span>
<a name="l00028"></a>00028 var $OrientationChanges; <span class="comment">//array indicating orientation changes</span>
<a name="l00029"></a>00029 var $k;                  <span class="comment">//scale factor (number of points in user unit)</span>
<a name="l00030"></a>00030 var $fwPt,$fhPt;         <span class="comment">//dimensions of page format in points</span>
<a name="l00031"></a>00031 var $fw,$fh;             <span class="comment">//dimensions of page format in user unit</span>
<a name="l00032"></a>00032 var $wPt,$hPt;           <span class="comment">//current dimensions of page in points</span>
<a name="l00033"></a>00033 var $w,$h;               <span class="comment">//current dimensions of page in user unit</span>
<a name="l00034"></a>00034 var $lMargin;            <span class="comment">//left margin</span>
<a name="l00035"></a>00035 var $tMargin;            <span class="comment">//top margin</span>
<a name="l00036"></a>00036 var $rMargin;            <span class="comment">//right margin</span>
<a name="l00037"></a>00037 var $bMargin;            <span class="comment">//page break margin</span>
<a name="l00038"></a>00038 var $cMargin;            <span class="comment">//cell margin</span>
<a name="l00039"></a>00039 var $x,$y;               <span class="comment">//current position in user unit for cell positioning</span>
<a name="l00040"></a>00040 var $lasth;              <span class="comment">//height of last cell printed</span>
<a name="l00041"></a>00041 var $LineWidth;          <span class="comment">//line width in user unit</span>
<a name="l00042"></a>00042 var $CoreFonts;          <span class="comment">//array of standard font names</span>
<a name="l00043"></a>00043 var $fonts;              <span class="comment">//array of used fonts</span>
<a name="l00044"></a>00044 var $FontFiles;          <span class="comment">//array of font files</span>
<a name="l00045"></a>00045 var $diffs;              <span class="comment">//array of encoding differences</span>
<a name="l00046"></a>00046 var $images;             <span class="comment">//array of used images</span>
<a name="l00047"></a>00047 var $PageLinks;          <span class="comment">//array of links in pages</span>
<a name="l00048"></a>00048 var $links;              <span class="comment">//array of internal links</span>
<a name="l00049"></a>00049 var $FontFamily;         <span class="comment">//current font family</span>
<a name="l00050"></a>00050 var $FontStyle;          <span class="comment">//current font style</span>
<a name="l00051"></a>00051 var $underline;          <span class="comment">//underlining flag</span>
<a name="l00052"></a>00052 var $CurrentFont;        <span class="comment">//current font info</span>
<a name="l00053"></a>00053 var $FontSizePt;         <span class="comment">//current font size in points</span>
<a name="l00054"></a>00054 var $FontSize;           <span class="comment">//current font size in user unit</span>
<a name="l00055"></a>00055 var $DrawColor;          <span class="comment">//commands for drawing color</span>
<a name="l00056"></a>00056 var $FillColor;          <span class="comment">//commands for filling color</span>
<a name="l00057"></a>00057 var $TextColor;          <span class="comment">//commands for text color</span>
<a name="l00058"></a>00058 var $ColorFlag;          <span class="comment">//indicates whether fill and text colors are different</span>
<a name="l00059"></a>00059 var $ws;                 <span class="comment">//word spacing</span>
<a name="l00060"></a>00060 var $AutoPageBreak;      <span class="comment">//automatic page breaking</span>
<a name="l00061"></a>00061 var $PageBreakTrigger;   <span class="comment">//threshold used to trigger page breaks</span>
<a name="l00062"></a>00062 var $InFooter;           <span class="comment">//flag set when processing footer</span>
<a name="l00063"></a>00063 var $ZoomMode;           <span class="comment">//zoom display mode</span>
<a name="l00064"></a>00064 var $LayoutMode;         <span class="comment">//layout display mode</span>
<a name="l00065"></a>00065 var $title;              <span class="comment">//title</span>
<a name="l00066"></a>00066 var $subject;            <span class="comment">//subject</span>
<a name="l00067"></a>00067 var $author;             <span class="comment">//author</span>
<a name="l00068"></a>00068 var $keywords;           <span class="comment">//keywords</span>
<a name="l00069"></a>00069 var $creator;            <span class="comment">//creator</span>
<a name="l00070"></a>00070 var $AliasNbPages;       <span class="comment">//alias for total number of pages</span>
<a name="l00071"></a>00071 var $PDFVersion;         <span class="comment">//PDF version number</span>
<a name="l00072"></a>00072 
<a name="l00073"></a>00073 <span class="comment">/*******************************************************************************</span>
<a name="l00074"></a>00074 <span class="comment">*                                                                              *</span>
<a name="l00075"></a>00075 <span class="comment">*                               Public methods                                 *</span>
<a name="l00076"></a>00076 <span class="comment">*                                                                              *</span>
<a name="l00077"></a>00077 <span class="comment">*******************************************************************************/</span>
<a name="l00078"></a>00078 <span class="keyword">function</span> FPDF($orientation=<span class="charliteral">&#39;P&#39;</span>,$unit=<span class="stringliteral">&#39;mm&#39;</span>,$format=<span class="stringliteral">&#39;A4&#39;</span>)
<a name="l00079"></a>00079 {
<a name="l00080"></a>00080     <span class="comment">//Some checks</span>
<a name="l00081"></a>00081     $this-&gt;_dochecks();
<a name="l00082"></a>00082     <span class="comment">//Initialization of properties</span>
<a name="l00083"></a>00083     $this-&gt;page=0;
<a name="l00084"></a>00084     $this-&gt;n=2;
<a name="l00085"></a>00085     $this-&gt;buffer=<span class="stringliteral">&#39;&#39;</span>;
<a name="l00086"></a>00086     $this-&gt;pages=array();
<a name="l00087"></a>00087     $this-&gt;OrientationChanges=array();
<a name="l00088"></a>00088     $this-&gt;state=0;
<a name="l00089"></a>00089     $this-&gt;fonts=array();
<a name="l00090"></a>00090     $this-&gt;FontFiles=array();
<a name="l00091"></a>00091     $this-&gt;diffs=array();
<a name="l00092"></a>00092     $this-&gt;images=array();
<a name="l00093"></a>00093     $this-&gt;links=array();
<a name="l00094"></a>00094     $this-&gt;InFooter=<span class="keyword">false</span>;
<a name="l00095"></a>00095     $this-&gt;lasth=0;
<a name="l00096"></a>00096     $this-&gt;FontFamily=<span class="stringliteral">&#39;&#39;</span>;
<a name="l00097"></a>00097     $this-&gt;FontStyle=<span class="stringliteral">&#39;&#39;</span>;
<a name="l00098"></a>00098     $this-&gt;FontSizePt=12;
<a name="l00099"></a>00099     $this-&gt;underline=<span class="keyword">false</span>;
<a name="l00100"></a>00100     $this-&gt;DrawColor=<span class="stringliteral">&#39;0 G&#39;</span>;
<a name="l00101"></a>00101     $this-&gt;FillColor=<span class="stringliteral">&#39;0 g&#39;</span>;
<a name="l00102"></a>00102     $this-&gt;TextColor=<span class="stringliteral">&#39;0 g&#39;</span>;
<a name="l00103"></a>00103     $this-&gt;ColorFlag=<span class="keyword">false</span>;
<a name="l00104"></a>00104     $this-&gt;ws=0;
<a name="l00105"></a>00105     <span class="comment">//Standard fonts</span>
<a name="l00106"></a>00106     $this-&gt;CoreFonts=array(<span class="stringliteral">&#39;courier&#39;</span>=&gt;<span class="stringliteral">&#39;Courier&#39;</span>,<span class="stringliteral">&#39;courierB&#39;</span>=&gt;<span class="stringliteral">&#39;Courier-Bold&#39;</span>,<span class="stringliteral">&#39;courierI&#39;</span>=&gt;<span class="stringliteral">&#39;Courier-Oblique&#39;</span>,<span class="stringliteral">&#39;courierBI&#39;</span>=&gt;<span class="stringliteral">&#39;Courier-BoldOblique&#39;</span>,
<a name="l00107"></a>00107         <span class="stringliteral">&#39;helvetica&#39;</span>=&gt;<span class="stringliteral">&#39;Helvetica&#39;</span>,<span class="stringliteral">&#39;helveticaB&#39;</span>=&gt;<span class="stringliteral">&#39;Helvetica-Bold&#39;</span>,<span class="stringliteral">&#39;helveticaI&#39;</span>=&gt;<span class="stringliteral">&#39;Helvetica-Oblique&#39;</span>,<span class="stringliteral">&#39;helveticaBI&#39;</span>=&gt;<span class="stringliteral">&#39;Helvetica-BoldOblique&#39;</span>,
<a name="l00108"></a>00108         <span class="stringliteral">&#39;times&#39;</span>=&gt;<span class="stringliteral">&#39;Times-Roman&#39;</span>,<span class="stringliteral">&#39;timesB&#39;</span>=&gt;<span class="stringliteral">&#39;Times-Bold&#39;</span>,<span class="stringliteral">&#39;timesI&#39;</span>=&gt;<span class="stringliteral">&#39;Times-Italic&#39;</span>,<span class="stringliteral">&#39;timesBI&#39;</span>=&gt;<span class="stringliteral">&#39;Times-BoldItalic&#39;</span>,
<a name="l00109"></a>00109         <span class="stringliteral">&#39;symbol&#39;</span>=&gt;<span class="stringliteral">&#39;Symbol&#39;</span>,<span class="stringliteral">&#39;zapfdingbats&#39;</span>=&gt;<span class="stringliteral">&#39;ZapfDingbats&#39;</span>);
<a name="l00110"></a>00110     <span class="comment">//Scale factor</span>
<a name="l00111"></a>00111     <span class="keywordflow">if</span>($unit==<span class="stringliteral">&#39;pt&#39;</span>)
<a name="l00112"></a>00112         $this-&gt;k=1;
<a name="l00113"></a>00113     elseif($unit==<span class="stringliteral">&#39;mm&#39;</span>)
<a name="l00114"></a>00114         $this-&gt;k=72/25.4;
<a name="l00115"></a>00115     elseif($unit==&#39;cm&#39;)
<a name="l00116"></a>00116         $this-&gt;k=72/2.54;
<a name="l00117"></a>00117     elseif($unit==&#39;in&#39;)
<a name="l00118"></a>00118         $this-&gt;k=72;
<a name="l00119"></a>00119     else
<a name="l00120"></a>00120         $this-&gt;Error(&#39;Incorrect unit: &#39;.$unit);
<a name="l00121"></a>00121     <span class="comment">//Page format</span>
<a name="l00122"></a>00122     <a class="code" href="admin__panel_8php.html#acdfe0026633f5372cbc1954f91109f30">if</a>(is_string($format))
<a name="l00123"></a>00123     {
<a name="l00124"></a>00124         $format=strtolower($format);
<a name="l00125"></a>00125         <span class="keywordflow">if</span>($format==<span class="stringliteral">&#39;a3&#39;</span>)
<a name="l00126"></a>00126             $format=array(841.89,1190.55);
<a name="l00127"></a>00127         elseif($format==<span class="stringliteral">&#39;a4&#39;</span>)
<a name="l00128"></a>00128             $format=array(595.28,841.89);
<a name="l00129"></a>00129         elseif($format==&#39;a5&#39;)
<a name="l00130"></a>00130             $format=array(420.94,595.28);
<a name="l00131"></a>00131         elseif($format==&#39;letter&#39;)
<a name="l00132"></a>00132             $format=array(612,792);
<a name="l00133"></a>00133         elseif($format==&#39;legal&#39;)
<a name="l00134"></a>00134             $format=array(612,1008);
<a name="l00135"></a>00135         else
<a name="l00136"></a>00136             $this-&gt;Error(&#39;Unknown page format: &#39;.$format);
<a name="l00137"></a>00137         $this-&gt;fwPt=$format[0];
<a name="l00138"></a>00138         $this-&gt;fhPt=$format[1];
<a name="l00139"></a>00139     }
<a name="l00140"></a>00140     else
<a name="l00141"></a>00141     {
<a name="l00142"></a>00142         $this-&gt;fwPt=$format[0]*$this-&gt;k;
<a name="l00143"></a>00143         $this-&gt;fhPt=$format[1]*$this-&gt;k;
<a name="l00144"></a>00144     }
<a name="l00145"></a>00145     $this-&gt;fw=$this-&gt;fwPt/$this-&gt;k;
<a name="l00146"></a>00146     $this-&gt;fh=$this-&gt;fhPt/$this-&gt;k;
<a name="l00147"></a>00147     <span class="comment">//Page orientation</span>
<a name="l00148"></a>00148     $orientation=strtolower($orientation);
<a name="l00149"></a>00149     <span class="keywordflow">if</span>($orientation==<span class="charliteral">&#39;p&#39;</span> || $orientation==<span class="stringliteral">&#39;portrait&#39;</span>)
<a name="l00150"></a>00150     {
<a name="l00151"></a>00151         $this-&gt;DefOrientation=<span class="charliteral">&#39;P&#39;</span>;
<a name="l00152"></a>00152         $this-&gt;wPt=$this-&gt;fwPt;
<a name="l00153"></a>00153         $this-&gt;hPt=$this-&gt;fhPt;
<a name="l00154"></a>00154     }
<a name="l00155"></a>00155     elseif($orientation==<span class="charliteral">&#39;l&#39;</span> || $orientation==<span class="stringliteral">&#39;landscape&#39;</span>)
<a name="l00156"></a>00156     {
<a name="l00157"></a>00157         $this-&gt;DefOrientation=<span class="charliteral">&#39;L&#39;</span>;
<a name="l00158"></a>00158         $this-&gt;wPt=$this-&gt;fhPt;
<a name="l00159"></a>00159         $this-&gt;hPt=$this-&gt;fwPt;
<a name="l00160"></a>00160     }
<a name="l00161"></a>00161     <span class="keywordflow">else</span>
<a name="l00162"></a>00162         $this-&gt;Error(<span class="stringliteral">&#39;Incorrect orientation: &#39;</span>.$orientation);
<a name="l00163"></a>00163     $this-&gt;CurOrientation=$this-&gt;DefOrientation;
<a name="l00164"></a>00164     $this-&gt;w=$this-&gt;wPt/$this-&gt;k;
<a name="l00165"></a>00165     $this-&gt;h=$this-&gt;hPt/$this-&gt;k;
<a name="l00166"></a>00166     <span class="comment">//Page margins (1 cm)</span>
<a name="l00167"></a>00167     $margin=28.35/$this-&gt;k;
<a name="l00168"></a>00168     $this-&gt;SetMargins($margin,$margin);
<a name="l00169"></a>00169     <span class="comment">//Interior cell margin (1 mm)</span>
<a name="l00170"></a>00170     $this-&gt;cMargin=$margin/10;
<a name="l00171"></a>00171     <span class="comment">//Line width (0.2 mm)</span>
<a name="l00172"></a>00172     $this-&gt;LineWidth=.567/$this-&gt;k;
<a name="l00173"></a>00173     <span class="comment">//Automatic page break</span>
<a name="l00174"></a>00174     $this-&gt;SetAutoPageBreak(<span class="keyword">true</span>,2*$margin);
<a name="l00175"></a>00175     <span class="comment">//Full width display mode</span>
<a name="l00176"></a>00176     $this-&gt;SetDisplayMode(<span class="stringliteral">&#39;fullwidth&#39;</span>);
<a name="l00177"></a>00177     <span class="comment">//Enable compression</span>
<a name="l00178"></a>00178     $this-&gt;SetCompression(<span class="keyword">true</span>);
<a name="l00179"></a>00179     <span class="comment">//Set default PDF version number</span>
<a name="l00180"></a>00180     $this-&gt;PDFVersion=<span class="stringliteral">&#39;1.3&#39;</span>;
<a name="l00181"></a>00181 }
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 <span class="keyword">function</span> SetMargins($left,$top,$right=-1)
<a name="l00184"></a>00184 {
<a name="l00185"></a>00185     <span class="comment">//Set left, top and right margins</span>
<a name="l00186"></a>00186     $this-&gt;lMargin=$left;
<a name="l00187"></a>00187     $this-&gt;tMargin=$top;
<a name="l00188"></a>00188     <span class="keywordflow">if</span>($right==-1)
<a name="l00189"></a>00189         $right=$left;
<a name="l00190"></a>00190     $this-&gt;rMargin=$right;
<a name="l00191"></a>00191 }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193 <span class="keyword">function</span> SetLeftMargin($margin)
<a name="l00194"></a>00194 {
<a name="l00195"></a>00195     <span class="comment">//Set left margin</span>
<a name="l00196"></a>00196     $this-&gt;lMargin=$margin;
<a name="l00197"></a>00197     <span class="keywordflow">if</span>($this-&gt;page&gt;0 &amp;&amp; $this-&gt;x&lt;$margin)
<a name="l00198"></a>00198         $this-&gt;x=$margin;
<a name="l00199"></a>00199 }
<a name="l00200"></a>00200 
<a name="l00201"></a>00201 <span class="keyword">function</span> SetTopMargin($margin)
<a name="l00202"></a>00202 {
<a name="l00203"></a>00203     <span class="comment">//Set top margin</span>
<a name="l00204"></a>00204     $this-&gt;tMargin=$margin;
<a name="l00205"></a>00205 }
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 <span class="keyword">function</span> SetRightMargin($margin)
<a name="l00208"></a>00208 {
<a name="l00209"></a>00209     <span class="comment">//Set right margin</span>
<a name="l00210"></a>00210     $this-&gt;rMargin=$margin;
<a name="l00211"></a>00211 }
<a name="l00212"></a>00212 
<a name="l00213"></a>00213 <span class="keyword">function</span> SetAutoPageBreak($auto,$margin=0)
<a name="l00214"></a>00214 {
<a name="l00215"></a>00215     <span class="comment">//Set auto page break mode and triggering margin</span>
<a name="l00216"></a>00216     $this-&gt;AutoPageBreak=$auto;
<a name="l00217"></a>00217     $this-&gt;bMargin=$margin;
<a name="l00218"></a>00218     $this-&gt;PageBreakTrigger=$this-&gt;h-$margin;
<a name="l00219"></a>00219 }
<a name="l00220"></a>00220 
<a name="l00221"></a>00221 <span class="keyword">function</span> SetDisplayMode($zoom,$layout=<span class="stringliteral">&#39;continuous&#39;</span>)
<a name="l00222"></a>00222 {
<a name="l00223"></a>00223     <span class="comment">//Set display mode in viewer</span>
<a name="l00224"></a>00224     <span class="keywordflow">if</span>($zoom==<span class="stringliteral">&#39;fullpage&#39;</span> || $zoom==<span class="stringliteral">&#39;fullwidth&#39;</span> || $zoom==<span class="stringliteral">&#39;real&#39;</span> || $zoom==<span class="stringliteral">&#39;default&#39;</span> || !is_string($zoom))
<a name="l00225"></a>00225         $this-&gt;ZoomMode=$zoom;
<a name="l00226"></a>00226     <span class="keywordflow">else</span>
<a name="l00227"></a>00227         $this-&gt;Error(<span class="stringliteral">&#39;Incorrect zoom display mode: &#39;</span>.$zoom);
<a name="l00228"></a>00228     <span class="keywordflow">if</span>($layout==<span class="stringliteral">&#39;single&#39;</span> || $layout==<span class="stringliteral">&#39;continuous&#39;</span> || $layout==<span class="stringliteral">&#39;two&#39;</span> || $layout==<span class="stringliteral">&#39;default&#39;</span>)
<a name="l00229"></a>00229         $this-&gt;LayoutMode=$layout;
<a name="l00230"></a>00230     <span class="keywordflow">else</span>
<a name="l00231"></a>00231         $this-&gt;Error(<span class="stringliteral">&#39;Incorrect layout display mode: &#39;</span>.$layout);
<a name="l00232"></a>00232 }
<a name="l00233"></a>00233 
<a name="l00234"></a>00234 <span class="keyword">function</span> SetCompression($compress)
<a name="l00235"></a>00235 {
<a name="l00236"></a>00236     <span class="comment">//Set page compression</span>
<a name="l00237"></a>00237     <span class="keywordflow">if</span>(function_exists(<span class="stringliteral">&#39;gzcompress&#39;</span>))
<a name="l00238"></a>00238         $this-&gt;compress=$compress;
<a name="l00239"></a>00239     <span class="keywordflow">else</span>
<a name="l00240"></a>00240         $this-&gt;compress=<span class="keyword">false</span>;
<a name="l00241"></a>00241 }
<a name="l00242"></a>00242 
<a name="l00243"></a>00243 <span class="keyword">function</span> SetTitle($title)
<a name="l00244"></a>00244 {
<a name="l00245"></a>00245     <span class="comment">//Title of document</span>
<a name="l00246"></a>00246     $this-&gt;title=$title;
<a name="l00247"></a>00247 }
<a name="l00248"></a>00248 
<a name="l00249"></a>00249 <span class="keyword">function</span> SetSubject($subject)
<a name="l00250"></a>00250 {
<a name="l00251"></a>00251     <span class="comment">//Subject of document</span>
<a name="l00252"></a>00252     $this-&gt;subject=$subject;
<a name="l00253"></a>00253 }
<a name="l00254"></a>00254 
<a name="l00255"></a>00255 <span class="keyword">function</span> SetAuthor($author)
<a name="l00256"></a>00256 {
<a name="l00257"></a>00257     <span class="comment">//Author of document</span>
<a name="l00258"></a>00258     $this-&gt;author=$author;
<a name="l00259"></a>00259 }
<a name="l00260"></a>00260 
<a name="l00261"></a>00261 <span class="keyword">function</span> SetKeywords($keywords)
<a name="l00262"></a>00262 {
<a name="l00263"></a>00263     <span class="comment">//Keywords of document</span>
<a name="l00264"></a>00264     $this-&gt;keywords=$keywords;
<a name="l00265"></a>00265 }
<a name="l00266"></a>00266 
<a name="l00267"></a>00267 <span class="keyword">function</span> SetCreator($creator)
<a name="l00268"></a>00268 {
<a name="l00269"></a>00269     <span class="comment">//Creator of document</span>
<a name="l00270"></a>00270     $this-&gt;creator=$creator;
<a name="l00271"></a>00271 }
<a name="l00272"></a>00272 
<a name="l00273"></a>00273 <span class="keyword">function</span> AliasNbPages($alias=<span class="stringliteral">&#39;{nb}&#39;</span>)
<a name="l00274"></a>00274 {
<a name="l00275"></a>00275     <span class="comment">//Define an alias for total number of pages</span>
<a name="l00276"></a>00276     $this-&gt;AliasNbPages=$alias;
<a name="l00277"></a>00277 }
<a name="l00278"></a>00278 
<a name="l00279"></a>00279 <span class="keyword">function</span> Error($msg)
<a name="l00280"></a>00280 {
<a name="l00281"></a>00281     <span class="comment">//Fatal error</span>
<a name="l00282"></a>00282     die(<span class="stringliteral">&#39;&lt;B&gt;FPDF error: &lt;/B&gt;&#39;</span>.$msg);
<a name="l00283"></a>00283 }
<a name="l00284"></a>00284 
<a name="l00285"></a>00285 <span class="keyword">function</span> Open()
<a name="l00286"></a>00286 {
<a name="l00287"></a>00287     <span class="comment">//Begin document</span>
<a name="l00288"></a>00288     $this-&gt;state=1;
<a name="l00289"></a>00289 }
<a name="l00290"></a>00290 
<a name="l00291"></a>00291 <span class="keyword">function</span> Close()
<a name="l00292"></a>00292 {
<a name="l00293"></a>00293     <span class="comment">//Terminate document</span>
<a name="l00294"></a>00294     <span class="keywordflow">if</span>($this-&gt;state==3)
<a name="l00295"></a>00295         <span class="keywordflow">return</span>;
<a name="l00296"></a>00296     <span class="keywordflow">if</span>($this-&gt;page==0)
<a name="l00297"></a>00297         $this-&gt;AddPage();
<a name="l00298"></a>00298     <span class="comment">//Page footer</span>
<a name="l00299"></a>00299     $this-&gt;InFooter=<span class="keyword">true</span>;
<a name="l00300"></a>00300     $this-&gt;Footer();
<a name="l00301"></a>00301     $this-&gt;InFooter=<span class="keyword">false</span>;
<a name="l00302"></a>00302     <span class="comment">//Close page</span>
<a name="l00303"></a>00303     $this-&gt;_endpage();
<a name="l00304"></a>00304     <span class="comment">//Close document</span>
<a name="l00305"></a>00305     $this-&gt;_enddoc();
<a name="l00306"></a>00306 }
<a name="l00307"></a>00307 
<a name="l00308"></a>00308 <span class="keyword">function</span> AddPage($orientation=<span class="stringliteral">&#39;&#39;</span>)
<a name="l00309"></a>00309 {
<a name="l00310"></a>00310     <span class="comment">//Start a new page</span>
<a name="l00311"></a>00311     <span class="keywordflow">if</span>($this-&gt;state==0)
<a name="l00312"></a>00312         $this-&gt;Open();
<a name="l00313"></a>00313     $family=$this-&gt;FontFamily;
<a name="l00314"></a>00314     $style=$this-&gt;FontStyle.($this-&gt;underline ? <span class="charliteral">&#39;U&#39;</span> : <span class="stringliteral">&#39;&#39;</span>);
<a name="l00315"></a>00315     $size=$this-&gt;FontSizePt;
<a name="l00316"></a>00316     $lw=$this-&gt;LineWidth;
<a name="l00317"></a>00317     $dc=$this-&gt;DrawColor;
<a name="l00318"></a>00318     $fc=$this-&gt;FillColor;
<a name="l00319"></a>00319     $tc=$this-&gt;TextColor;
<a name="l00320"></a>00320     $cf=$this-&gt;ColorFlag;
<a name="l00321"></a>00321     <span class="keywordflow">if</span>($this-&gt;page&gt;0)
<a name="l00322"></a>00322     {
<a name="l00323"></a>00323         <span class="comment">//Page footer</span>
<a name="l00324"></a>00324         $this-&gt;InFooter=<span class="keyword">true</span>;
<a name="l00325"></a>00325         $this-&gt;Footer();
<a name="l00326"></a>00326         $this-&gt;InFooter=<span class="keyword">false</span>;
<a name="l00327"></a>00327         <span class="comment">//Close page</span>
<a name="l00328"></a>00328         $this-&gt;_endpage();
<a name="l00329"></a>00329     }
<a name="l00330"></a>00330     <span class="comment">//Start new page</span>
<a name="l00331"></a>00331     $this-&gt;_beginpage($orientation);
<a name="l00332"></a>00332     <span class="comment">//Set line cap style to square</span>
<a name="l00333"></a>00333     $this-&gt;_out(<span class="stringliteral">&#39;2 J&#39;</span>);
<a name="l00334"></a>00334     <span class="comment">//Set line width</span>
<a name="l00335"></a>00335     $this-&gt;LineWidth=$lw;
<a name="l00336"></a>00336     $this-&gt;_out(sprintf(<span class="stringliteral">&#39;%.2f w&#39;</span>,$lw*$this-&gt;k));
<a name="l00337"></a>00337     <span class="comment">//Set font</span>
<a name="l00338"></a>00338     <span class="keywordflow">if</span>($family)
<a name="l00339"></a>00339         $this-&gt;SetFont($family,$style,$size);
<a name="l00340"></a>00340     <span class="comment">//Set colors</span>
<a name="l00341"></a>00341     $this-&gt;DrawColor=$dc;
<a name="l00342"></a>00342     <span class="keywordflow">if</span>($dc!=<span class="stringliteral">&#39;0 G&#39;</span>)
<a name="l00343"></a>00343         $this-&gt;_out($dc);
<a name="l00344"></a>00344     $this-&gt;FillColor=$fc;
<a name="l00345"></a>00345     <span class="keywordflow">if</span>($fc!=<span class="stringliteral">&#39;0 g&#39;</span>)
<a name="l00346"></a>00346         $this-&gt;_out($fc);
<a name="l00347"></a>00347     $this-&gt;TextColor=$tc;
<a name="l00348"></a>00348     $this-&gt;ColorFlag=$cf;
<a name="l00349"></a>00349     <span class="comment">//Page header</span>
<a name="l00350"></a>00350     $this-&gt;Header();
<a name="l00351"></a>00351     <span class="comment">//Restore line width</span>
<a name="l00352"></a>00352     <span class="keywordflow">if</span>($this-&gt;LineWidth!=$lw)
<a name="l00353"></a>00353     {
<a name="l00354"></a>00354         $this-&gt;LineWidth=$lw;
<a name="l00355"></a>00355         $this-&gt;_out(sprintf(<span class="stringliteral">&#39;%.2f w&#39;</span>,$lw*$this-&gt;k));
<a name="l00356"></a>00356     }
<a name="l00357"></a>00357     <span class="comment">//Restore font</span>
<a name="l00358"></a>00358     <span class="keywordflow">if</span>($family)
<a name="l00359"></a>00359         $this-&gt;SetFont($family,$style,$size);
<a name="l00360"></a>00360     <span class="comment">//Restore colors</span>
<a name="l00361"></a>00361     <span class="keywordflow">if</span>($this-&gt;DrawColor!=$dc)
<a name="l00362"></a>00362     {
<a name="l00363"></a>00363         $this-&gt;DrawColor=$dc;
<a name="l00364"></a>00364         $this-&gt;_out($dc);
<a name="l00365"></a>00365     }
<a name="l00366"></a>00366     <span class="keywordflow">if</span>($this-&gt;FillColor!=$fc)
<a name="l00367"></a>00367     {
<a name="l00368"></a>00368         $this-&gt;FillColor=$fc;
<a name="l00369"></a>00369         $this-&gt;_out($fc);
<a name="l00370"></a>00370     }
<a name="l00371"></a>00371     $this-&gt;TextColor=$tc;
<a name="l00372"></a>00372     $this-&gt;ColorFlag=$cf;
<a name="l00373"></a>00373 }
<a name="l00374"></a>00374 
<a name="l00375"></a>00375 <span class="keyword">function</span> Header()
<a name="l00376"></a>00376 {
<a name="l00377"></a>00377     <span class="comment">//To be implemented in your own inherited class</span>
<a name="l00378"></a>00378 }
<a name="l00379"></a>00379 
<a name="l00380"></a>00380 <span class="keyword">function</span> Footer()
<a name="l00381"></a>00381 {
<a name="l00382"></a>00382     <span class="comment">//To be implemented in your own inherited class</span>
<a name="l00383"></a>00383 }
<a name="l00384"></a>00384 
<a name="l00385"></a>00385 <span class="keyword">function</span> PageNo()
<a name="l00386"></a>00386 {
<a name="l00387"></a>00387     <span class="comment">//Get current page number</span>
<a name="l00388"></a>00388     <span class="keywordflow">return</span> $this-&gt;page;
<a name="l00389"></a>00389 }
<a name="l00390"></a>00390 
<a name="l00391"></a>00391 <span class="keyword">function</span> SetDrawColor($r,$g=-1,$b=-1)
<a name="l00392"></a>00392 {
<a name="l00393"></a>00393     <span class="comment">//Set color for all stroking operations</span>
<a name="l00394"></a>00394     <span class="keywordflow">if</span>(($r==0 &amp;&amp; $g==0 &amp;&amp; $b==0) || $g==-1)
<a name="l00395"></a>00395         $this-&gt;DrawColor=sprintf(<span class="stringliteral">&#39;%.3f G&#39;</span>,$r/255);
<a name="l00396"></a>00396     <span class="keywordflow">else</span>
<a name="l00397"></a>00397         $this-&gt;DrawColor=sprintf(<span class="stringliteral">&#39;%.3f %.3f %.3f RG&#39;</span>,$r/255,$g/255,$b/255);
<a name="l00398"></a>00398     <span class="keywordflow">if</span>($this-&gt;page&gt;0)
<a name="l00399"></a>00399         $this-&gt;_out($this-&gt;DrawColor);
<a name="l00400"></a>00400 }
<a name="l00401"></a>00401 
<a name="l00402"></a>00402 <span class="keyword">function</span> SetFillColor($r,$g=-1,$b=-1)
<a name="l00403"></a>00403 {
<a name="l00404"></a>00404     <span class="comment">//Set color for all filling operations</span>
<a name="l00405"></a>00405     <span class="keywordflow">if</span>(($r==0 &amp;&amp; $g==0 &amp;&amp; $b==0) || $g==-1)
<a name="l00406"></a>00406         $this-&gt;FillColor=sprintf(<span class="stringliteral">&#39;%.3f g&#39;</span>,$r/255);
<a name="l00407"></a>00407     <span class="keywordflow">else</span>
<a name="l00408"></a>00408         $this-&gt;FillColor=sprintf(<span class="stringliteral">&#39;%.3f %.3f %.3f rg&#39;</span>,$r/255,$g/255,$b/255);
<a name="l00409"></a>00409     $this-&gt;ColorFlag=($this-&gt;FillColor!=$this-&gt;TextColor);
<a name="l00410"></a>00410     <span class="keywordflow">if</span>($this-&gt;page&gt;0)
<a name="l00411"></a>00411         $this-&gt;_out($this-&gt;FillColor);
<a name="l00412"></a>00412 }
<a name="l00413"></a>00413 
<a name="l00414"></a>00414 <span class="keyword">function</span> SetTextColor($r,$g=-1,$b=-1)
<a name="l00415"></a>00415 {
<a name="l00416"></a>00416     <span class="comment">//Set color for text</span>
<a name="l00417"></a>00417     <span class="keywordflow">if</span>(($r==0 &amp;&amp; $g==0 &amp;&amp; $b==0) || $g==-1)
<a name="l00418"></a>00418         $this-&gt;TextColor=sprintf(<span class="stringliteral">&#39;%.3f g&#39;</span>,$r/255);
<a name="l00419"></a>00419     <span class="keywordflow">else</span>
<a name="l00420"></a>00420         $this-&gt;TextColor=sprintf(<span class="stringliteral">&#39;%.3f %.3f %.3f rg&#39;</span>,$r/255,$g/255,$b/255);
<a name="l00421"></a>00421     $this-&gt;ColorFlag=($this-&gt;FillColor!=$this-&gt;TextColor);
<a name="l00422"></a>00422 }
<a name="l00423"></a>00423 
<a name="l00424"></a>00424 <span class="keyword">function</span> GetStringWidth($s)
<a name="l00425"></a>00425 {
<a name="l00426"></a>00426     <span class="comment">//Get width of a string in the current font</span>
<a name="l00427"></a>00427     $s=(string)$s;
<a name="l00428"></a>00428     $cw=&amp;$this-&gt;CurrentFont[<span class="stringliteral">&#39;cw&#39;</span>];
<a name="l00429"></a>00429     $w=0;
<a name="l00430"></a>00430     $l=strlen($s);
<a name="l00431"></a>00431     <span class="keywordflow">for</span>($i=0;$i&lt;$l;$i++)
<a name="l00432"></a>00432         $w+=$cw[$s{$i}];
<a name="l00433"></a>00433     <span class="keywordflow">return</span> $w*$this-&gt;FontSize/1000;
<a name="l00434"></a>00434 }
<a name="l00435"></a>00435 
<a name="l00436"></a>00436 <span class="keyword">function</span> SetLineWidth($width)
<a name="l00437"></a>00437 {
<a name="l00438"></a>00438     <span class="comment">//Set line width</span>
<a name="l00439"></a>00439     $this-&gt;LineWidth=$width;
<a name="l00440"></a>00440     <span class="keywordflow">if</span>($this-&gt;page&gt;0)
<a name="l00441"></a>00441         $this-&gt;_out(sprintf(<span class="stringliteral">&#39;%.2f w&#39;</span>,$width*$this-&gt;k));
<a name="l00442"></a>00442 }
<a name="l00443"></a>00443 
<a name="l00444"></a>00444 <span class="keyword">function</span> Line($x1,$y1,$x2,$y2)
<a name="l00445"></a>00445 {
<a name="l00446"></a>00446     <span class="comment">//Draw a line</span>
<a name="l00447"></a>00447     $this-&gt;_out(sprintf(<span class="stringliteral">&#39;%.2f %.2f m %.2f %.2f l S&#39;</span>,$x1*$this-&gt;k,($this-&gt;h-$y1)*$this-&gt;k,$x2*$this-&gt;k,($this-&gt;h-$y2)*$this-&gt;k));
<a name="l00448"></a>00448 }
<a name="l00449"></a>00449 
<a name="l00450"></a>00450 <span class="keyword">function</span> Rect($x,$y,$w,$h,$style=<span class="stringliteral">&#39;&#39;</span>)
<a name="l00451"></a>00451 {
<a name="l00452"></a>00452     <span class="comment">//Draw a rectangle</span>
<a name="l00453"></a>00453     <span class="keywordflow">if</span>($style==<span class="charliteral">&#39;F&#39;</span>)
<a name="l00454"></a>00454         $op=<span class="charliteral">&#39;f&#39;</span>;
<a name="l00455"></a>00455     elseif($style==<span class="stringliteral">&#39;FD&#39;</span> || $style==<span class="stringliteral">&#39;DF&#39;</span>)
<a name="l00456"></a>00456         $op=&#39;B&#39;;
<a name="l00457"></a>00457     else
<a name="l00458"></a>00458         $op=&#39;S&#39;;
<a name="l00459"></a>00459     $this-&gt;_out(sprintf(&#39;%.2f %.2f %.2f %.2f re %s&#39;,$x*$this-&gt;k,($this-&gt;h-$y)*$this-&gt;k,$w*$this-&gt;k,-$h*$this-&gt;k,$op));
<a name="l00460"></a>00460 }
<a name="l00461"></a>00461 
<a name="l00462"></a>00462 function AddFont($family,$style=&#39;&#39;,$file=&#39;&#39;)
<a name="l00463"></a>00463 {
<a name="l00464"></a>00464     <span class="comment">//Add a TrueType or Type1 font</span>
<a name="l00465"></a>00465     $family=strtolower($family);
<a name="l00466"></a>00466     <span class="keywordflow">if</span>($file==<span class="stringliteral">&#39;&#39;</span>)
<a name="l00467"></a>00467         $file=str_replace(<span class="charliteral">&#39; &#39;</span>,<span class="stringliteral">&#39;&#39;</span>,$family).strtolower($style).<span class="stringliteral">&#39;.php&#39;</span>;
<a name="l00468"></a>00468     <span class="keywordflow">if</span>($family==<span class="stringliteral">&#39;arial&#39;</span>)
<a name="l00469"></a>00469         $family=<span class="stringliteral">&#39;helvetica&#39;</span>;
<a name="l00470"></a>00470     $style=strtoupper($style);
<a name="l00471"></a>00471     <span class="keywordflow">if</span>($style==<span class="stringliteral">&#39;IB&#39;</span>)
<a name="l00472"></a>00472         $style=<span class="stringliteral">&#39;BI&#39;</span>;
<a name="l00473"></a>00473     $fontkey=$family.$style;
<a name="l00474"></a>00474     <span class="keywordflow">if</span>(isset($this-&gt;fonts[$fontkey]))
<a name="l00475"></a>00475         $this-&gt;Error(<span class="stringliteral">&#39;Font already added: &#39;</span>.$family.<span class="charliteral">&#39; &#39;</span>.$style);
<a name="l00476"></a>00476     include($this-&gt;_getfontpath().$file);
<a name="l00477"></a>00477     <span class="keywordflow">if</span>(!isset($name))
<a name="l00478"></a>00478         $this-&gt;Error(<span class="stringliteral">&#39;Could not include font definition file&#39;</span>);
<a name="l00479"></a>00479     $i=count($this-&gt;fonts)+1;
<a name="l00480"></a>00480     $this-&gt;fonts[$fontkey]=array(<span class="charliteral">&#39;i&#39;</span>=&gt;$i,<span class="stringliteral">&#39;type&#39;</span>=&gt;$type,<span class="stringliteral">&#39;name&#39;</span>=&gt;$name,<span class="stringliteral">&#39;desc&#39;</span>=&gt;$desc,<span class="stringliteral">&#39;up&#39;</span>=&gt;$up,<span class="stringliteral">&#39;ut&#39;</span>=&gt;$ut,<span class="stringliteral">&#39;cw&#39;</span>=&gt;$cw,<span class="stringliteral">&#39;enc&#39;</span>=&gt;$enc,<span class="stringliteral">&#39;file&#39;</span>=&gt;$file);
<a name="l00481"></a>00481     <span class="keywordflow">if</span>($diff)
<a name="l00482"></a>00482     {
<a name="l00483"></a>00483         <span class="comment">//Search existing encodings</span>
<a name="l00484"></a>00484         $d=0;
<a name="l00485"></a>00485         $nb=count($this-&gt;diffs);
<a name="l00486"></a>00486         <span class="keywordflow">for</span>($i=1;$i&lt;=$nb;$i++)
<a name="l00487"></a>00487         {
<a name="l00488"></a>00488             <span class="keywordflow">if</span>($this-&gt;diffs[$i]==$diff)
<a name="l00489"></a>00489             {
<a name="l00490"></a>00490                 $d=$i;
<a name="l00491"></a>00491                 <span class="keywordflow">break</span>;
<a name="l00492"></a>00492             }
<a name="l00493"></a>00493         }
<a name="l00494"></a>00494         <span class="keywordflow">if</span>($d==0)
<a name="l00495"></a>00495         {
<a name="l00496"></a>00496             $d=$nb+1;
<a name="l00497"></a>00497             $this-&gt;diffs[$d]=$diff;
<a name="l00498"></a>00498         }
<a name="l00499"></a>00499         $this-&gt;fonts[$fontkey][<span class="stringliteral">&#39;diff&#39;</span>]=$d;
<a name="l00500"></a>00500     }
<a name="l00501"></a>00501     <span class="keywordflow">if</span>($file)
<a name="l00502"></a>00502     {
<a name="l00503"></a>00503         <span class="keywordflow">if</span>($type==<span class="stringliteral">&#39;TrueType&#39;</span>)
<a name="l00504"></a>00504             $this-&gt;FontFiles[$file]=array(<span class="stringliteral">&#39;length1&#39;</span>=&gt;$originalsize);
<a name="l00505"></a>00505         <span class="keywordflow">else</span>
<a name="l00506"></a>00506             $this-&gt;FontFiles[$file]=array(<span class="stringliteral">&#39;length1&#39;</span>=&gt;$size1,<span class="stringliteral">&#39;length2&#39;</span>=&gt;$size2);
<a name="l00507"></a>00507     }
<a name="l00508"></a>00508 }
<a name="l00509"></a>00509 
<a name="l00510"></a>00510 <span class="keyword">function</span> SetFont($family,$style=<span class="stringliteral">&#39;&#39;</span>,$size=0)
<a name="l00511"></a>00511 {
<a name="l00512"></a>00512     <span class="comment">//Select a font; size given in points</span>
<a name="l00513"></a>00513     global <a class="code" href="courier_8php.html#a191dba904071eb8ce58aee4c4cb6eefd">$fpdf_charwidths</a>;
<a name="l00514"></a>00514 
<a name="l00515"></a>00515     $family=strtolower($family);
<a name="l00516"></a>00516     <span class="keywordflow">if</span>($family==<span class="stringliteral">&#39;&#39;</span>)
<a name="l00517"></a>00517         $family=$this-&gt;FontFamily;
<a name="l00518"></a>00518     <span class="keywordflow">if</span>($family==<span class="stringliteral">&#39;arial&#39;</span>)
<a name="l00519"></a>00519         $family=<span class="stringliteral">&#39;helvetica&#39;</span>;
<a name="l00520"></a>00520     elseif($family==<span class="stringliteral">&#39;symbol&#39;</span> || $family==<span class="stringliteral">&#39;zapfdingbats&#39;</span>)
<a name="l00521"></a>00521         $style=&#39;&#39;;
<a name="l00522"></a>00522     $style=strtoupper($style);
<a name="l00523"></a>00523     <a class="code" href="admin__panel_8php.html#acdfe0026633f5372cbc1954f91109f30">if</a>(strpos($style,&#39;U&#39;)!==false)
<a name="l00524"></a>00524     {
<a name="l00525"></a>00525         $this-&gt;underline=<span class="keyword">true</span>;
<a name="l00526"></a>00526         $style=str_replace(<span class="charliteral">&#39;U&#39;</span>,<span class="stringliteral">&#39;&#39;</span>,$style);
<a name="l00527"></a>00527     }
<a name="l00528"></a>00528     <span class="keywordflow">else</span>
<a name="l00529"></a>00529         $this-&gt;underline=<span class="keyword">false</span>;
<a name="l00530"></a>00530     <span class="keywordflow">if</span>($style==<span class="stringliteral">&#39;IB&#39;</span>)
<a name="l00531"></a>00531         $style=<span class="stringliteral">&#39;BI&#39;</span>;
<a name="l00532"></a>00532     <span class="keywordflow">if</span>($size==0)
<a name="l00533"></a>00533         $size=$this-&gt;FontSizePt;
<a name="l00534"></a>00534     <span class="comment">//Test if font is already selected</span>
<a name="l00535"></a>00535     <span class="keywordflow">if</span>($this-&gt;FontFamily==$family &amp;&amp; $this-&gt;FontStyle==$style &amp;&amp; $this-&gt;FontSizePt==$size)
<a name="l00536"></a>00536         <span class="keywordflow">return</span>;
<a name="l00537"></a>00537     <span class="comment">//Test if used for the first time</span>
<a name="l00538"></a>00538     $fontkey=$family.$style;
<a name="l00539"></a>00539     <span class="keywordflow">if</span>(!isset($this-&gt;fonts[$fontkey]))
<a name="l00540"></a>00540     {
<a name="l00541"></a>00541         <span class="comment">//Check if one of the standard fonts</span>
<a name="l00542"></a>00542         <span class="keywordflow">if</span>(isset($this-&gt;CoreFonts[$fontkey]))
<a name="l00543"></a>00543         {
<a name="l00544"></a>00544             <span class="keywordflow">if</span>(!isset($fpdf_charwidths[$fontkey]))
<a name="l00545"></a>00545             {
<a name="l00546"></a>00546                 <span class="comment">//Load metric file</span>
<a name="l00547"></a>00547                 $file=$family;
<a name="l00548"></a>00548                 <span class="keywordflow">if</span>($family==<span class="stringliteral">&#39;times&#39;</span> || $family==<span class="stringliteral">&#39;helvetica&#39;</span>)
<a name="l00549"></a>00549                     $file.=strtolower($style);
<a name="l00550"></a>00550                 include($this-&gt;_getfontpath().$file.<span class="stringliteral">&#39;.php&#39;</span>);
<a name="l00551"></a>00551                 <span class="keywordflow">if</span>(!isset($fpdf_charwidths[$fontkey]))
<a name="l00552"></a>00552                     $this-&gt;Error(<span class="stringliteral">&#39;Could not include font metric file&#39;</span>);
<a name="l00553"></a>00553             }
<a name="l00554"></a>00554             $i=count($this-&gt;fonts)+1;
<a name="l00555"></a>00555             $this-&gt;fonts[$fontkey]=array(<span class="charliteral">&#39;i&#39;</span>=&gt;$i,<span class="stringliteral">&#39;type&#39;</span>=&gt;<span class="stringliteral">&#39;core&#39;</span>,<span class="stringliteral">&#39;name&#39;</span>=&gt;$this-&gt;CoreFonts[$fontkey],<span class="stringliteral">&#39;up&#39;</span>=&gt;-100,<span class="stringliteral">&#39;ut&#39;</span>=&gt;50,<span class="stringliteral">&#39;cw&#39;</span>=&gt;$fpdf_charwidths[$fontkey]);
<a name="l00556"></a>00556         }
<a name="l00557"></a>00557         <span class="keywordflow">else</span>
<a name="l00558"></a>00558             $this-&gt;Error(<span class="stringliteral">&#39;Undefined font: &#39;</span>.$family.<span class="charliteral">&#39; &#39;</span>.$style);
<a name="l00559"></a>00559     }
<a name="l00560"></a>00560     <span class="comment">//Select it</span>
<a name="l00561"></a>00561     $this-&gt;FontFamily=$family;
<a name="l00562"></a>00562     $this-&gt;FontStyle=$style;
<a name="l00563"></a>00563     $this-&gt;FontSizePt=$size;
<a name="l00564"></a>00564     $this-&gt;FontSize=$size/$this-&gt;k;
<a name="l00565"></a>00565     $this-&gt;CurrentFont=&amp;$this-&gt;fonts[$fontkey];
<a name="l00566"></a>00566     <span class="keywordflow">if</span>($this-&gt;page&gt;0)
<a name="l00567"></a>00567         $this-&gt;_out(sprintf(<span class="stringliteral">&#39;BT /F%d %.2f Tf ET&#39;</span>,$this-&gt;CurrentFont[<span class="charliteral">&#39;i&#39;</span>],$this-&gt;FontSizePt));
<a name="l00568"></a>00568 }
<a name="l00569"></a>00569 
<a name="l00570"></a>00570 <span class="keyword">function</span> SetFontSize($size)
<a name="l00571"></a>00571 {
<a name="l00572"></a>00572     <span class="comment">//Set font size in points</span>
<a name="l00573"></a>00573     <span class="keywordflow">if</span>($this-&gt;FontSizePt==$size)
<a name="l00574"></a>00574         <span class="keywordflow">return</span>;
<a name="l00575"></a>00575     $this-&gt;FontSizePt=$size;
<a name="l00576"></a>00576     $this-&gt;FontSize=$size/$this-&gt;k;
<a name="l00577"></a>00577     <span class="keywordflow">if</span>($this-&gt;page&gt;0)
<a name="l00578"></a>00578         $this-&gt;_out(sprintf(<span class="stringliteral">&#39;BT /F%d %.2f Tf ET&#39;</span>,$this-&gt;CurrentFont[<span class="charliteral">&#39;i&#39;</span>],$this-&gt;FontSizePt));
<a name="l00579"></a>00579 }
<a name="l00580"></a>00580 
<a name="l00581"></a>00581 <span class="keyword">function</span> AddLink()
<a name="l00582"></a>00582 {
<a name="l00583"></a>00583     <span class="comment">//Create a new internal link</span>
<a name="l00584"></a>00584     $n=count($this-&gt;links)+1;
<a name="l00585"></a>00585     $this-&gt;links[$n]=array(0,0);
<a name="l00586"></a>00586     <span class="keywordflow">return</span> $n;
<a name="l00587"></a>00587 }
<a name="l00588"></a>00588 
<a name="l00589"></a>00589 <span class="keyword">function</span> SetLink($link,$y=0,$page=-1)
<a name="l00590"></a>00590 {
<a name="l00591"></a>00591     <span class="comment">//Set destination of internal link</span>
<a name="l00592"></a>00592     <span class="keywordflow">if</span>($y==-1)
<a name="l00593"></a>00593         $y=$this-&gt;y;
<a name="l00594"></a>00594     <span class="keywordflow">if</span>($page==-1)
<a name="l00595"></a>00595         $page=$this-&gt;page;
<a name="l00596"></a>00596     $this-&gt;links[$link]=array($page,$y);
<a name="l00597"></a>00597 }
<a name="l00598"></a>00598 
<a name="l00599"></a>00599 <span class="keyword">function</span> Link($x,$y,$w,$h,$link)
<a name="l00600"></a>00600 {
<a name="l00601"></a>00601     <span class="comment">//Put a link on the page</span>
<a name="l00602"></a>00602     $this-&gt;PageLinks[$this-&gt;page][]=array($x*$this-&gt;k,$this-&gt;hPt-$y*$this-&gt;k,$w*$this-&gt;k,$h*$this-&gt;k,$link);
<a name="l00603"></a>00603 }
<a name="l00604"></a>00604 
<a name="l00605"></a>00605 <span class="keyword">function</span> Text($x,$y,$txt)
<a name="l00606"></a>00606 {
<a name="l00607"></a>00607     <span class="comment">//Output a string</span>
<a name="l00608"></a>00608     $s=sprintf(<span class="stringliteral">&#39;BT %.2f %.2f Td (%s) Tj ET&#39;</span>,$x*$this-&gt;k,($this-&gt;h-$y)*$this-&gt;k,$this-&gt;_escape($txt));
<a name="l00609"></a>00609     <span class="keywordflow">if</span>($this-&gt;underline &amp;&amp; $txt!=<span class="stringliteral">&#39;&#39;</span>)
<a name="l00610"></a>00610         $s.=<span class="charliteral">&#39; &#39;</span>.$this-&gt;_dounderline($x,$y,$txt);
<a name="l00611"></a>00611     <span class="keywordflow">if</span>($this-&gt;ColorFlag)
<a name="l00612"></a>00612         $s=<span class="stringliteral">&#39;q &#39;</span>.$this-&gt;TextColor.<span class="charliteral">&#39; &#39;</span>.$s.<span class="stringliteral">&#39; Q&#39;</span>;
<a name="l00613"></a>00613     $this-&gt;_out($s);
<a name="l00614"></a>00614 }
<a name="l00615"></a>00615 
<a name="l00616"></a>00616 <span class="keyword">function</span> AcceptPageBreak()
<a name="l00617"></a>00617 {
<a name="l00618"></a>00618     <span class="comment">//Accept automatic page break or not</span>
<a name="l00619"></a>00619     <span class="keywordflow">return</span> $this-&gt;AutoPageBreak;
<a name="l00620"></a>00620 }
<a name="l00621"></a>00621 
<a name="l00622"></a>00622 <span class="keyword">function</span> Cell($w,$h=0,$txt=<span class="stringliteral">&#39;&#39;</span>,$border=0,$ln=0,$align=<span class="stringliteral">&#39;&#39;</span>,$fill=0,$link=<span class="stringliteral">&#39;&#39;</span>)
<a name="l00623"></a>00623 {
<a name="l00624"></a>00624     <span class="comment">//Output a cell</span>
<a name="l00625"></a>00625     $k=$this-&gt;k;
<a name="l00626"></a>00626     <span class="keywordflow">if</span>($this-&gt;y+$h&gt;$this-&gt;PageBreakTrigger &amp;&amp; !$this-&gt;InFooter &amp;&amp; $this-&gt;AcceptPageBreak())
<a name="l00627"></a>00627     {
<a name="l00628"></a>00628         <span class="comment">//Automatic page break</span>
<a name="l00629"></a>00629         $x=$this-&gt;x;
<a name="l00630"></a>00630         $ws=$this-&gt;ws;
<a name="l00631"></a>00631         <span class="keywordflow">if</span>($ws&gt;0)
<a name="l00632"></a>00632         {
<a name="l00633"></a>00633             $this-&gt;ws=0;
<a name="l00634"></a>00634             $this-&gt;_out(<span class="stringliteral">&#39;0 Tw&#39;</span>);
<a name="l00635"></a>00635         }
<a name="l00636"></a>00636         $this-&gt;AddPage($this-&gt;CurOrientation);
<a name="l00637"></a>00637         $this-&gt;x=$x;
<a name="l00638"></a>00638         <span class="keywordflow">if</span>($ws&gt;0)
<a name="l00639"></a>00639         {
<a name="l00640"></a>00640             $this-&gt;ws=$ws;
<a name="l00641"></a>00641             $this-&gt;_out(sprintf(<span class="stringliteral">&#39;%.3f Tw&#39;</span>,$ws*$k));
<a name="l00642"></a>00642         }
<a name="l00643"></a>00643     }
<a name="l00644"></a>00644     <span class="keywordflow">if</span>($w==0)
<a name="l00645"></a>00645         $w=$this-&gt;w-$this-&gt;rMargin-$this-&gt;x;
<a name="l00646"></a>00646     $s=<span class="stringliteral">&#39;&#39;</span>;
<a name="l00647"></a>00647     <span class="keywordflow">if</span>($fill==1 || $border==1)
<a name="l00648"></a>00648     {
<a name="l00649"></a>00649         <span class="keywordflow">if</span>($fill==1)
<a name="l00650"></a>00650             $op=($border==1) ? <span class="charliteral">&#39;B&#39;</span> : <span class="charliteral">&#39;f&#39;</span>;
<a name="l00651"></a>00651         <span class="keywordflow">else</span>
<a name="l00652"></a>00652             $op=<span class="charliteral">&#39;S&#39;</span>;
<a name="l00653"></a>00653         $s=sprintf(<span class="stringliteral">&#39;%.2f %.2f %.2f %.2f re %s &#39;</span>,$this-&gt;x*$k,($this-&gt;h-$this-&gt;y)*$k,$w*$k,-$h*$k,$op);
<a name="l00654"></a>00654     }
<a name="l00655"></a>00655     <span class="keywordflow">if</span>(is_string($border))
<a name="l00656"></a>00656     {
<a name="l00657"></a>00657         $x=$this-&gt;x;
<a name="l00658"></a>00658         $y=$this-&gt;y;
<a name="l00659"></a>00659         <span class="keywordflow">if</span>(strpos($border,<span class="charliteral">&#39;L&#39;</span>)!==<span class="keyword">false</span>)
<a name="l00660"></a>00660             $s.=sprintf(<span class="stringliteral">&#39;%.2f %.2f m %.2f %.2f l S &#39;</span>,$x*$k,($this-&gt;h-$y)*$k,$x*$k,($this-&gt;h-($y+$h))*$k);
<a name="l00661"></a>00661         <span class="keywordflow">if</span>(strpos($border,<span class="charliteral">&#39;T&#39;</span>)!==<span class="keyword">false</span>)
<a name="l00662"></a>00662             $s.=sprintf(<span class="stringliteral">&#39;%.2f %.2f m %.2f %.2f l S &#39;</span>,$x*$k,($this-&gt;h-$y)*$k,($x+$w)*$k,($this-&gt;h-$y)*$k);
<a name="l00663"></a>00663         <span class="keywordflow">if</span>(strpos($border,<span class="charliteral">&#39;R&#39;</span>)!==<span class="keyword">false</span>)
<a name="l00664"></a>00664             $s.=sprintf(<span class="stringliteral">&#39;%.2f %.2f m %.2f %.2f l S &#39;</span>,($x+$w)*$k,($this-&gt;h-$y)*$k,($x+$w)*$k,($this-&gt;h-($y+$h))*$k);
<a name="l00665"></a>00665         <span class="keywordflow">if</span>(strpos($border,<span class="charliteral">&#39;B&#39;</span>)!==<span class="keyword">false</span>)
<a name="l00666"></a>00666             $s.=sprintf(<span class="stringliteral">&#39;%.2f %.2f m %.2f %.2f l S &#39;</span>,$x*$k,($this-&gt;h-($y+$h))*$k,($x+$w)*$k,($this-&gt;h-($y+$h))*$k);
<a name="l00667"></a>00667     }
<a name="l00668"></a>00668     <span class="keywordflow">if</span>($txt!==<span class="stringliteral">&#39;&#39;</span>)
<a name="l00669"></a>00669     {
<a name="l00670"></a>00670         <span class="keywordflow">if</span>($align==<span class="charliteral">&#39;R&#39;</span>)
<a name="l00671"></a>00671             $dx=$w-$this-&gt;cMargin-$this-&gt;GetStringWidth($txt);
<a name="l00672"></a>00672         elseif($align==<span class="charliteral">&#39;C&#39;</span>)
<a name="l00673"></a>00673             $dx=($w-$this-&gt;GetStringWidth($txt))/2;
<a name="l00674"></a>00674         else
<a name="l00675"></a>00675             $dx=$this-&gt;cMargin;
<a name="l00676"></a>00676         <a class="code" href="admin__panel_8php.html#acdfe0026633f5372cbc1954f91109f30">if</a>($this-&gt;ColorFlag)
<a name="l00677"></a>00677             $s.=&#39;q &#39;.$this-&gt;TextColor.&#39; &#39;;
<a name="l00678"></a>00678         $txt2=str_replace(&#39;)&#39;,&#39;\\)&#39;,str_replace(&#39;(&#39;,&#39;\\(&#39;,str_replace(&#39;\\&#39;,&#39;\\\\&#39;,$txt)));
<a name="l00679"></a>00679         $s.=sprintf(&#39;BT %.2f %.2f Td (%s) Tj ET&#39;,($this-&gt;x+$dx)*$k,($this-&gt;h-($this-&gt;y+.5*$h+.3*$this-&gt;FontSize))*$k,$txt2);
<a name="l00680"></a>00680         <a class="code" href="admin__panel_8php.html#acdfe0026633f5372cbc1954f91109f30">if</a>($this-&gt;underline)
<a name="l00681"></a>00681             $s.=&#39; &#39;.$this-&gt;_dounderline($this-&gt;x+$dx,$this-&gt;y+.5*$h+.3*$this-&gt;FontSize,$txt);
<a name="l00682"></a>00682         <a class="code" href="admin__panel_8php.html#acdfe0026633f5372cbc1954f91109f30">if</a>($this-&gt;ColorFlag)
<a name="l00683"></a>00683             $s.=&#39; Q&#39;;
<a name="l00684"></a>00684         <a class="code" href="admin__panel_8php.html#acdfe0026633f5372cbc1954f91109f30">if</a>($link)
<a name="l00685"></a>00685             $this-&gt;Link($this-&gt;x+$dx,$this-&gt;y+.5*$h-.5*$this-&gt;FontSize,$this-&gt;GetStringWidth($txt),$this-&gt;FontSize,$link);
<a name="l00686"></a>00686     }
<a name="l00687"></a>00687     <a class="code" href="admin__panel_8php.html#acdfe0026633f5372cbc1954f91109f30">if</a>($s)
<a name="l00688"></a>00688         $this-&gt;_out($s);
<a name="l00689"></a>00689     $this-&gt;lasth=$h;
<a name="l00690"></a>00690     <a class="code" href="admin__panel_8php.html#acdfe0026633f5372cbc1954f91109f30">if</a>($ln&gt;0)
<a name="l00691"></a>00691     {
<a name="l00692"></a>00692         <span class="comment">//Go to next line</span>
<a name="l00693"></a>00693         $this-&gt;y+=$h;
<a name="l00694"></a>00694         <span class="keywordflow">if</span>($ln==1)
<a name="l00695"></a>00695             $this-&gt;x=$this-&gt;lMargin;
<a name="l00696"></a>00696     }
<a name="l00697"></a>00697     <span class="keywordflow">else</span>
<a name="l00698"></a>00698         $this-&gt;x+=$w;
<a name="l00699"></a>00699 }
<a name="l00700"></a>00700 
<a name="l00701"></a>00701 <span class="keyword">function</span> MultiCell($w,$h,$txt,$border=0,$align=<span class="charliteral">&#39;J&#39;</span>,$fill=0)
<a name="l00702"></a>00702 {
<a name="l00703"></a>00703     <span class="comment">//Output text with automatic or explicit line breaks</span>
<a name="l00704"></a>00704     $cw=&amp;$this-&gt;CurrentFont[<span class="stringliteral">&#39;cw&#39;</span>];
<a name="l00705"></a>00705     <span class="keywordflow">if</span>($w==0)
<a name="l00706"></a>00706         $w=$this-&gt;w-$this-&gt;rMargin-$this-&gt;x;
<a name="l00707"></a>00707     $wmax=($w-2*$this-&gt;cMargin)*1000/$this-&gt;FontSize;
<a name="l00708"></a>00708     $s=str_replace(<span class="stringliteral">&quot;\r&quot;</span>,<span class="stringliteral">&#39;&#39;</span>,$txt);
<a name="l00709"></a>00709     $nb=strlen($s);
<a name="l00710"></a>00710     <span class="keywordflow">if</span>($nb&gt;0 &amp;&amp; $s[$nb-1]==<span class="stringliteral">&quot;\n&quot;</span>)
<a name="l00711"></a>00711         $nb--;
<a name="l00712"></a>00712     $b=0;
<a name="l00713"></a>00713     <span class="keywordflow">if</span>($border)
<a name="l00714"></a>00714     {
<a name="l00715"></a>00715         <span class="keywordflow">if</span>($border==1)
<a name="l00716"></a>00716         {
<a name="l00717"></a>00717             $border=<span class="stringliteral">&#39;LTRB&#39;</span>;
<a name="l00718"></a>00718             $b=<span class="stringliteral">&#39;LRT&#39;</span>;
<a name="l00719"></a>00719             $b2=<span class="stringliteral">&#39;LR&#39;</span>;
<a name="l00720"></a>00720         }
<a name="l00721"></a>00721         <span class="keywordflow">else</span>
<a name="l00722"></a>00722         {
<a name="l00723"></a>00723             $b2=<span class="stringliteral">&#39;&#39;</span>;
<a name="l00724"></a>00724             <span class="keywordflow">if</span>(strpos($border,<span class="charliteral">&#39;L&#39;</span>)!==<span class="keyword">false</span>)
<a name="l00725"></a>00725                 $b2.=<span class="charliteral">&#39;L&#39;</span>;
<a name="l00726"></a>00726             <span class="keywordflow">if</span>(strpos($border,<span class="charliteral">&#39;R&#39;</span>)!==<span class="keyword">false</span>)
<a name="l00727"></a>00727                 $b2.=<span class="charliteral">&#39;R&#39;</span>;
<a name="l00728"></a>00728             $b=(strpos($border,<span class="charliteral">&#39;T&#39;</span>)!==<span class="keyword">false</span>) ? $b2.<span class="charliteral">&#39;T&#39;</span> : $b2;
<a name="l00729"></a>00729         }
<a name="l00730"></a>00730     }
<a name="l00731"></a>00731     $sep=-1;
<a name="l00732"></a>00732     $i=0;
<a name="l00733"></a>00733     $j=0;
<a name="l00734"></a>00734     $l=0;
<a name="l00735"></a>00735     $ns=0;
<a name="l00736"></a>00736     $nl=1;
<a name="l00737"></a>00737     <span class="keywordflow">while</span>($i&lt;$nb)
<a name="l00738"></a>00738     {
<a name="l00739"></a>00739         <span class="comment">//Get next character</span>
<a name="l00740"></a>00740         $c=$s{$i};
<a name="l00741"></a>00741         <span class="keywordflow">if</span>($c==<span class="stringliteral">&quot;\n&quot;</span>)
<a name="l00742"></a>00742         {
<a name="l00743"></a>00743             <span class="comment">//Explicit line break</span>
<a name="l00744"></a>00744             <span class="keywordflow">if</span>($this-&gt;ws&gt;0)
<a name="l00745"></a>00745             {
<a name="l00746"></a>00746                 $this-&gt;ws=0;
<a name="l00747"></a>00747                 $this-&gt;_out(<span class="stringliteral">&#39;0 Tw&#39;</span>);
<a name="l00748"></a>00748             }
<a name="l00749"></a>00749             $this-&gt;Cell($w,$h,substr($s,$j,$i-$j),$b,2,$align,$fill);
<a name="l00750"></a>00750             $i++;
<a name="l00751"></a>00751             $sep=-1;
<a name="l00752"></a>00752             $j=$i;
<a name="l00753"></a>00753             $l=0;
<a name="l00754"></a>00754             $ns=0;
<a name="l00755"></a>00755             $nl++;
<a name="l00756"></a>00756             <span class="keywordflow">if</span>($border &amp;&amp; $nl==2)
<a name="l00757"></a>00757                 $b=$b2;
<a name="l00758"></a>00758             <span class="keywordflow">continue</span>;
<a name="l00759"></a>00759         }
<a name="l00760"></a>00760         <span class="keywordflow">if</span>($c==<span class="charliteral">&#39; &#39;</span>)
<a name="l00761"></a>00761         {
<a name="l00762"></a>00762             $sep=$i;
<a name="l00763"></a>00763             $ls=$l;
<a name="l00764"></a>00764             $ns++;
<a name="l00765"></a>00765         }
<a name="l00766"></a>00766         $l+=$cw[$c];
<a name="l00767"></a>00767         <span class="keywordflow">if</span>($l&gt;$wmax)
<a name="l00768"></a>00768         {
<a name="l00769"></a>00769             <span class="comment">//Automatic line break</span>
<a name="l00770"></a>00770             <span class="keywordflow">if</span>($sep==-1)
<a name="l00771"></a>00771             {
<a name="l00772"></a>00772                 <span class="keywordflow">if</span>($i==$j)
<a name="l00773"></a>00773                     $i++;
<a name="l00774"></a>00774                 <span class="keywordflow">if</span>($this-&gt;ws&gt;0)
<a name="l00775"></a>00775                 {
<a name="l00776"></a>00776                     $this-&gt;ws=0;
<a name="l00777"></a>00777                     $this-&gt;_out(<span class="stringliteral">&#39;0 Tw&#39;</span>);
<a name="l00778"></a>00778                 }
<a name="l00779"></a>00779                 $this-&gt;Cell($w,$h,substr($s,$j,$i-$j),$b,2,$align,$fill);
<a name="l00780"></a>00780             }
<a name="l00781"></a>00781             <span class="keywordflow">else</span>
<a name="l00782"></a>00782             {
<a name="l00783"></a>00783                 <span class="keywordflow">if</span>($align==<span class="charliteral">&#39;J&#39;</span>)
<a name="l00784"></a>00784                 {
<a name="l00785"></a>00785                     $this-&gt;ws=($ns&gt;1) ? ($wmax-$ls)/1000*$this-&gt;FontSize/($ns-1) : 0;
<a name="l00786"></a>00786                     $this-&gt;_out(sprintf(<span class="stringliteral">&#39;%.3f Tw&#39;</span>,$this-&gt;ws*$this-&gt;k));
<a name="l00787"></a>00787                 }
<a name="l00788"></a>00788                 $this-&gt;Cell($w,$h,substr($s,$j,$sep-$j),$b,2,$align,$fill);
<a name="l00789"></a>00789                 $i=$sep+1;
<a name="l00790"></a>00790             }
<a name="l00791"></a>00791             $sep=-1;
<a name="l00792"></a>00792             $j=$i;
<a name="l00793"></a>00793             $l=0;
<a name="l00794"></a>00794             $ns=0;
<a name="l00795"></a>00795             $nl++;
<a name="l00796"></a>00796             <span class="keywordflow">if</span>($border &amp;&amp; $nl==2)
<a name="l00797"></a>00797                 $b=$b2;
<a name="l00798"></a>00798         }
<a name="l00799"></a>00799         <span class="keywordflow">else</span>
<a name="l00800"></a>00800             $i++;
<a name="l00801"></a>00801     }
<a name="l00802"></a>00802     <span class="comment">//Last chunk</span>
<a name="l00803"></a>00803     <span class="keywordflow">if</span>($this-&gt;ws&gt;0)
<a name="l00804"></a>00804     {
<a name="l00805"></a>00805         $this-&gt;ws=0;
<a name="l00806"></a>00806         $this-&gt;_out(<span class="stringliteral">&#39;0 Tw&#39;</span>);
<a name="l00807"></a>00807     }
<a name="l00808"></a>00808     <span class="keywordflow">if</span>($border &amp;&amp; strpos($border,<span class="charliteral">&#39;B&#39;</span>)!==<span class="keyword">false</span>)
<a name="l00809"></a>00809         $b.=<span class="charliteral">&#39;B&#39;</span>;
<a name="l00810"></a>00810     $this-&gt;Cell($w,$h,substr($s,$j,$i-$j),$b,2,$align,$fill);
<a name="l00811"></a>00811     $this-&gt;x=$this-&gt;lMargin;
<a name="l00812"></a>00812 }
<a name="l00813"></a>00813 
<a name="l00814"></a>00814 <span class="keyword">function</span> Write($h,$txt,$link=<span class="stringliteral">&#39;&#39;</span>)
<a name="l00815"></a>00815 {
<a name="l00816"></a>00816     <span class="comment">//Output text in flowing mode</span>
<a name="l00817"></a>00817     $cw=&amp;$this-&gt;CurrentFont[<span class="stringliteral">&#39;cw&#39;</span>];
<a name="l00818"></a>00818     $w=$this-&gt;w-$this-&gt;rMargin-$this-&gt;x;
<a name="l00819"></a>00819     $wmax=($w-2*$this-&gt;cMargin)*1000/$this-&gt;FontSize;
<a name="l00820"></a>00820     $s=str_replace(<span class="stringliteral">&quot;\r&quot;</span>,<span class="stringliteral">&#39;&#39;</span>,$txt);
<a name="l00821"></a>00821     $nb=strlen($s);
<a name="l00822"></a>00822     $sep=-1;
<a name="l00823"></a>00823     $i=0;
<a name="l00824"></a>00824     $j=0;
<a name="l00825"></a>00825     $l=0;
<a name="l00826"></a>00826     $nl=1;
<a name="l00827"></a>00827     <span class="keywordflow">while</span>($i&lt;$nb)
<a name="l00828"></a>00828     {
<a name="l00829"></a>00829         <span class="comment">//Get next character</span>
<a name="l00830"></a>00830         $c=$s{$i};
<a name="l00831"></a>00831         <span class="keywordflow">if</span>($c==<span class="stringliteral">&quot;\n&quot;</span>)
<a name="l00832"></a>00832         {
<a name="l00833"></a>00833             <span class="comment">//Explicit line break</span>
<a name="l00834"></a>00834             $this-&gt;Cell($w,$h,substr($s,$j,$i-$j),0,2,<span class="stringliteral">&#39;&#39;</span>,0,$link);
<a name="l00835"></a>00835             $i++;
<a name="l00836"></a>00836             $sep=-1;
<a name="l00837"></a>00837             $j=$i;
<a name="l00838"></a>00838             $l=0;
<a name="l00839"></a>00839             <span class="keywordflow">if</span>($nl==1)
<a name="l00840"></a>00840             {
<a name="l00841"></a>00841                 $this-&gt;x=$this-&gt;lMargin;
<a name="l00842"></a>00842                 $w=$this-&gt;w-$this-&gt;rMargin-$this-&gt;x;
<a name="l00843"></a>00843                 $wmax=($w-2*$this-&gt;cMargin)*1000/$this-&gt;FontSize;
<a name="l00844"></a>00844             }
<a name="l00845"></a>00845             $nl++;
<a name="l00846"></a>00846             <span class="keywordflow">continue</span>;
<a name="l00847"></a>00847         }
<a name="l00848"></a>00848         <span class="keywordflow">if</span>($c==<span class="charliteral">&#39; &#39;</span>)
<a name="l00849"></a>00849             $sep=$i;
<a name="l00850"></a>00850         $l+=$cw[$c];
<a name="l00851"></a>00851         <span class="keywordflow">if</span>($l&gt;$wmax)
<a name="l00852"></a>00852         {
<a name="l00853"></a>00853             <span class="comment">//Automatic line break</span>
<a name="l00854"></a>00854             <span class="keywordflow">if</span>($sep==-1)
<a name="l00855"></a>00855             {
<a name="l00856"></a>00856                 <span class="keywordflow">if</span>($this-&gt;x&gt;$this-&gt;lMargin)
<a name="l00857"></a>00857                 {
<a name="l00858"></a>00858                     <span class="comment">//Move to next line</span>
<a name="l00859"></a>00859                     $this-&gt;x=$this-&gt;lMargin;
<a name="l00860"></a>00860                     $this-&gt;y+=$h;
<a name="l00861"></a>00861                     $w=$this-&gt;w-$this-&gt;rMargin-$this-&gt;x;
<a name="l00862"></a>00862                     $wmax=($w-2*$this-&gt;cMargin)*1000/$this-&gt;FontSize;
<a name="l00863"></a>00863                     $i++;
<a name="l00864"></a>00864                     $nl++;
<a name="l00865"></a>00865                     <span class="keywordflow">continue</span>;
<a name="l00866"></a>00866                 }
<a name="l00867"></a>00867                 <span class="keywordflow">if</span>($i==$j)
<a name="l00868"></a>00868                     $i++;
<a name="l00869"></a>00869                 $this-&gt;Cell($w,$h,substr($s,$j,$i-$j),0,2,<span class="stringliteral">&#39;&#39;</span>,0,$link);
<a name="l00870"></a>00870             }
<a name="l00871"></a>00871             <span class="keywordflow">else</span>
<a name="l00872"></a>00872             {
<a name="l00873"></a>00873                 $this-&gt;Cell($w,$h,substr($s,$j,$sep-$j),0,2,<span class="stringliteral">&#39;&#39;</span>,0,$link);
<a name="l00874"></a>00874                 $i=$sep+1;
<a name="l00875"></a>00875             }
<a name="l00876"></a>00876             $sep=-1;
<a name="l00877"></a>00877             $j=$i;
<a name="l00878"></a>00878             $l=0;
<a name="l00879"></a>00879             <span class="keywordflow">if</span>($nl==1)
<a name="l00880"></a>00880             {
<a name="l00881"></a>00881                 $this-&gt;x=$this-&gt;lMargin;
<a name="l00882"></a>00882                 $w=$this-&gt;w-$this-&gt;rMargin-$this-&gt;x;
<a name="l00883"></a>00883                 $wmax=($w-2*$this-&gt;cMargin)*1000/$this-&gt;FontSize;
<a name="l00884"></a>00884             }
<a name="l00885"></a>00885             $nl++;
<a name="l00886"></a>00886         }
<a name="l00887"></a>00887         <span class="keywordflow">else</span>
<a name="l00888"></a>00888             $i++;
<a name="l00889"></a>00889     }
<a name="l00890"></a>00890     <span class="comment">//Last chunk</span>
<a name="l00891"></a>00891     <span class="keywordflow">if</span>($i!=$j)
<a name="l00892"></a>00892         $this-&gt;Cell($l/1000*$this-&gt;FontSize,$h,substr($s,$j),0,0,<span class="stringliteral">&#39;&#39;</span>,0,$link);
<a name="l00893"></a>00893 }
<a name="l00894"></a>00894 
<a name="l00895"></a>00895 <span class="keyword">function</span> Image($file,$x,$y,$w=0,$h=0,$type=<span class="stringliteral">&#39;&#39;</span>,$link=<span class="stringliteral">&#39;&#39;</span>)
<a name="l00896"></a>00896 {
<a name="l00897"></a>00897     <span class="comment">//Put an image on the page</span>
<a name="l00898"></a>00898     <span class="keywordflow">if</span>(!isset($this-&gt;images[$file]))
<a name="l00899"></a>00899     {
<a name="l00900"></a>00900         <span class="comment">//First use of image, get info</span>
<a name="l00901"></a>00901         <span class="keywordflow">if</span>($type==<span class="stringliteral">&#39;&#39;</span>)
<a name="l00902"></a>00902         {
<a name="l00903"></a>00903             $pos=strrpos($file,<span class="charliteral">&#39;.&#39;</span>);
<a name="l00904"></a>00904             <span class="keywordflow">if</span>(!$pos)
<a name="l00905"></a>00905                 $this-&gt;Error(<span class="stringliteral">&#39;Image file has no extension and no type was specified: &#39;</span>.$file);
<a name="l00906"></a>00906             $type=substr($file,$pos+1);
<a name="l00907"></a>00907         }
<a name="l00908"></a>00908         $type=strtolower($type);
<a name="l00909"></a>00909         $mqr=get_magic_quotes_runtime();
<a name="l00910"></a>00910         set_magic_quotes_runtime(0);
<a name="l00911"></a>00911         <span class="keywordflow">if</span>($type==<span class="stringliteral">&#39;jpg&#39;</span> || $type==<span class="stringliteral">&#39;jpeg&#39;</span>)
<a name="l00912"></a>00912             $info=$this-&gt;_parsejpg($file);
<a name="l00913"></a>00913         elseif($type==<span class="stringliteral">&#39;png&#39;</span>)
<a name="l00914"></a>00914             $info=$this-&gt;_parsepng($file);
<a name="l00915"></a>00915         else
<a name="l00916"></a>00916         {
<a name="l00917"></a>00917             <span class="comment">//Allow for additional formats</span>
<a name="l00918"></a>00918             $mtd=<span class="stringliteral">&#39;_parse&#39;</span>.$type;
<a name="l00919"></a>00919             <span class="keywordflow">if</span>(!method_exists($this,$mtd))
<a name="l00920"></a>00920                 $this-&gt;Error(<span class="stringliteral">&#39;Unsupported image type: &#39;</span>.$type);
<a name="l00921"></a>00921             $info=$this-&gt;$mtd($file);
<a name="l00922"></a>00922         }
<a name="l00923"></a>00923         set_magic_quotes_runtime($mqr);
<a name="l00924"></a>00924         $info[<span class="charliteral">&#39;i&#39;</span>]=count($this-&gt;images)+1;
<a name="l00925"></a>00925         $this-&gt;images[$file]=$info;
<a name="l00926"></a>00926     }
<a name="l00927"></a>00927     <span class="keywordflow">else</span>
<a name="l00928"></a>00928         $info=$this-&gt;images[$file];
<a name="l00929"></a>00929     <span class="comment">//Automatic width and height calculation if needed</span>
<a name="l00930"></a>00930     <span class="keywordflow">if</span>($w==0 &amp;&amp; $h==0)
<a name="l00931"></a>00931     {
<a name="l00932"></a>00932         <span class="comment">//Put image at 72 dpi</span>
<a name="l00933"></a>00933         $w=$info[<span class="charliteral">&#39;w&#39;</span>]/$this-&gt;k;
<a name="l00934"></a>00934         $h=$info[<span class="charliteral">&#39;h&#39;</span>]/$this-&gt;k;
<a name="l00935"></a>00935     }
<a name="l00936"></a>00936     <span class="keywordflow">if</span>($w==0)
<a name="l00937"></a>00937         $w=$h*$info[<span class="charliteral">&#39;w&#39;</span>]/$info[<span class="charliteral">&#39;h&#39;</span>];
<a name="l00938"></a>00938     <span class="keywordflow">if</span>($h==0)
<a name="l00939"></a>00939         $h=$w*$info[<span class="charliteral">&#39;h&#39;</span>]/$info[<span class="charliteral">&#39;w&#39;</span>];
<a name="l00940"></a>00940     $this-&gt;_out(sprintf(<span class="stringliteral">&#39;q %.2f 0 0 %.2f %.2f %.2f cm /I%d Do Q&#39;</span>,$w*$this-&gt;k,$h*$this-&gt;k,$x*$this-&gt;k,($this-&gt;h-($y+$h))*$this-&gt;k,$info[<span class="charliteral">&#39;i&#39;</span>]));
<a name="l00941"></a>00941     <span class="keywordflow">if</span>($link)
<a name="l00942"></a>00942         $this-&gt;Link($x,$y,$w,$h,$link);
<a name="l00943"></a>00943 }
<a name="l00944"></a>00944 
<a name="l00945"></a>00945 <span class="keyword">function</span> Ln($h=<span class="stringliteral">&#39;&#39;</span>)
<a name="l00946"></a>00946 {
<a name="l00947"></a>00947     <span class="comment">//Line feed; default value is last cell height</span>
<a name="l00948"></a>00948     $this-&gt;x=$this-&gt;lMargin;
<a name="l00949"></a>00949     <span class="keywordflow">if</span>(is_string($h))
<a name="l00950"></a>00950         $this-&gt;y+=$this-&gt;lasth;
<a name="l00951"></a>00951     <span class="keywordflow">else</span>
<a name="l00952"></a>00952         $this-&gt;y+=$h;
<a name="l00953"></a>00953 }
<a name="l00954"></a>00954 
<a name="l00955"></a>00955 <span class="keyword">function</span> GetX()
<a name="l00956"></a>00956 {
<a name="l00957"></a>00957     <span class="comment">//Get x position</span>
<a name="l00958"></a>00958     <span class="keywordflow">return</span> $this-&gt;x;
<a name="l00959"></a>00959 }
<a name="l00960"></a>00960 
<a name="l00961"></a>00961 <span class="keyword">function</span> SetX($x)
<a name="l00962"></a>00962 {
<a name="l00963"></a>00963     <span class="comment">//Set x position</span>
<a name="l00964"></a>00964     <span class="keywordflow">if</span>($x&gt;=0)
<a name="l00965"></a>00965         $this-&gt;x=$x;
<a name="l00966"></a>00966     <span class="keywordflow">else</span>
<a name="l00967"></a>00967         $this-&gt;x=$this-&gt;w+$x;
<a name="l00968"></a>00968 }
<a name="l00969"></a>00969 
<a name="l00970"></a>00970 <span class="keyword">function</span> GetY()
<a name="l00971"></a>00971 {
<a name="l00972"></a>00972     <span class="comment">//Get y position</span>
<a name="l00973"></a>00973     <span class="keywordflow">return</span> $this-&gt;y;
<a name="l00974"></a>00974 }
<a name="l00975"></a>00975 
<a name="l00976"></a>00976 <span class="keyword">function</span> SetY($y)
<a name="l00977"></a>00977 {
<a name="l00978"></a>00978     <span class="comment">//Set y position and reset x</span>
<a name="l00979"></a>00979     $this-&gt;x=$this-&gt;lMargin;
<a name="l00980"></a>00980     <span class="keywordflow">if</span>($y&gt;=0)
<a name="l00981"></a>00981         $this-&gt;y=$y;
<a name="l00982"></a>00982     <span class="keywordflow">else</span>
<a name="l00983"></a>00983         $this-&gt;y=$this-&gt;h+$y;
<a name="l00984"></a>00984 }
<a name="l00985"></a>00985 
<a name="l00986"></a>00986 <span class="keyword">function</span> SetXY($x,$y)
<a name="l00987"></a>00987 {
<a name="l00988"></a>00988     <span class="comment">//Set x and y positions</span>
<a name="l00989"></a>00989     $this-&gt;SetY($y);
<a name="l00990"></a>00990     $this-&gt;SetX($x);
<a name="l00991"></a>00991 }
<a name="l00992"></a>00992 
<a name="l00993"></a>00993 <span class="keyword">function</span> Output($name=<span class="stringliteral">&#39;&#39;</span>,$dest=<span class="stringliteral">&#39;&#39;</span>)
<a name="l00994"></a>00994 {
<a name="l00995"></a>00995     <span class="comment">//Output PDF to some destination</span>
<a name="l00996"></a>00996     <span class="comment">//Finish document if necessary</span>
<a name="l00997"></a>00997     <span class="keywordflow">if</span>($this-&gt;state&lt;3)
<a name="l00998"></a>00998         $this-&gt;Close();
<a name="l00999"></a>00999     <span class="comment">//Normalize parameters</span>
<a name="l01000"></a>01000     <span class="keywordflow">if</span>(is_bool($dest))
<a name="l01001"></a>01001         $dest=$dest ? <span class="charliteral">&#39;D&#39;</span> : <span class="charliteral">&#39;F&#39;</span>;
<a name="l01002"></a>01002     $dest=strtoupper($dest);
<a name="l01003"></a>01003     <span class="keywordflow">if</span>($dest==<span class="stringliteral">&#39;&#39;</span>)
<a name="l01004"></a>01004     {
<a name="l01005"></a>01005         <span class="keywordflow">if</span>($name==<span class="stringliteral">&#39;&#39;</span>)
<a name="l01006"></a>01006         {
<a name="l01007"></a>01007             $name=<span class="stringliteral">&#39;doc.pdf&#39;</span>;
<a name="l01008"></a>01008             $dest=<span class="charliteral">&#39;I&#39;</span>;
<a name="l01009"></a>01009         }
<a name="l01010"></a>01010         <span class="keywordflow">else</span>
<a name="l01011"></a>01011             $dest=<span class="charliteral">&#39;F&#39;</span>;
<a name="l01012"></a>01012     }
<a name="l01013"></a>01013     <span class="keywordflow">switch</span>($dest)
<a name="l01014"></a>01014     {
<a name="l01015"></a>01015         <span class="keywordflow">case</span> <span class="charliteral">&#39;I&#39;</span>:
<a name="l01016"></a>01016             <span class="comment">//Send to standard output</span>
<a name="l01017"></a>01017             <span class="keywordflow">if</span>(ob_get_contents())
<a name="l01018"></a>01018                 $this-&gt;Error(<span class="stringliteral">&#39;Some data has already been output, can\&#39;t send PDF file&#39;</span>);
<a name="l01019"></a>01019             <span class="keywordflow">if</span>(php_sapi_name()!=<span class="stringliteral">&#39;cli&#39;</span>)
<a name="l01020"></a>01020             {
<a name="l01021"></a>01021                 <span class="comment">//We send to a browser</span>
<a name="l01022"></a>01022                 header(<span class="stringliteral">&#39;Content-Type: application/pdf&#39;</span>);
<a name="l01023"></a>01023                 <span class="keywordflow">if</span>(headers_sent())
<a name="l01024"></a>01024                     $this-&gt;Error(<span class="stringliteral">&#39;Some data has already been output to browser, can\&#39;t send PDF file&#39;</span>);
<a name="l01025"></a>01025                 header(<span class="stringliteral">&#39;Content-Length: &#39;</span>.strlen($this-&gt;buffer));
<a name="l01026"></a>01026                 header(<span class="stringliteral">&#39;Content-disposition: inline; filename=&quot;&#39;</span>.$name.<span class="charliteral">&#39;&quot;&#39;</span>);
<a name="l01027"></a>01027             }
<a name="l01028"></a>01028             echo $this-&gt;buffer;
<a name="l01029"></a>01029             <span class="keywordflow">break</span>;
<a name="l01030"></a>01030         <span class="keywordflow">case</span> <span class="charliteral">&#39;D&#39;</span>:
<a name="l01031"></a>01031             <span class="comment">//Download file</span>
<a name="l01032"></a>01032             <span class="keywordflow">if</span>(ob_get_contents())
<a name="l01033"></a>01033                 $this-&gt;Error(<span class="stringliteral">&#39;Some data has already been output, can\&#39;t send PDF file&#39;</span>);
<a name="l01034"></a>01034             <span class="keywordflow">if</span>(isset($_SERVER[<span class="stringliteral">&#39;HTTP_USER_AGENT&#39;</span>]) &amp;&amp; strpos($_SERVER[<span class="stringliteral">&#39;HTTP_USER_AGENT&#39;</span>],<span class="stringliteral">&#39;MSIE&#39;</span>))
<a name="l01035"></a>01035                 header(<span class="stringliteral">&#39;Content-Type: application/force-download&#39;</span>);
<a name="l01036"></a>01036             <span class="keywordflow">else</span>
<a name="l01037"></a>01037                 header(<span class="stringliteral">&#39;Content-Type: application/octet-stream&#39;</span>);
<a name="l01038"></a>01038             <span class="keywordflow">if</span>(headers_sent())
<a name="l01039"></a>01039                 $this-&gt;Error(<span class="stringliteral">&#39;Some data has already been output to browser, can\&#39;t send PDF file&#39;</span>);
<a name="l01040"></a>01040             header(<span class="stringliteral">&#39;Content-Length: &#39;</span>.strlen($this-&gt;buffer));
<a name="l01041"></a>01041             header(<span class="stringliteral">&#39;Content-disposition: attachment; filename=&quot;&#39;</span>.$name.<span class="charliteral">&#39;&quot;&#39;</span>);
<a name="l01042"></a>01042             echo $this-&gt;buffer;
<a name="l01043"></a>01043             <span class="keywordflow">break</span>;
<a name="l01044"></a>01044         <span class="keywordflow">case</span> <span class="charliteral">&#39;F&#39;</span>:
<a name="l01045"></a>01045             <span class="comment">//Save to local file</span>
<a name="l01046"></a>01046             $f=fopen($name,<span class="stringliteral">&#39;wb&#39;</span>);
<a name="l01047"></a>01047             <span class="keywordflow">if</span>(!$f)
<a name="l01048"></a>01048                 $this-&gt;Error(<span class="stringliteral">&#39;Unable to create output file: &#39;</span>.$name);
<a name="l01049"></a>01049             fwrite($f,$this-&gt;buffer,strlen($this-&gt;buffer));
<a name="l01050"></a>01050             fclose($f);
<a name="l01051"></a>01051             <span class="keywordflow">break</span>;
<a name="l01052"></a>01052         <span class="keywordflow">case</span> <span class="charliteral">&#39;S&#39;</span>:
<a name="l01053"></a>01053             <span class="comment">//Return as a string</span>
<a name="l01054"></a>01054             <span class="keywordflow">return</span> $this-&gt;buffer;
<a name="l01055"></a>01055         <span class="keywordflow">default</span>:
<a name="l01056"></a>01056             $this-&gt;Error(<span class="stringliteral">&#39;Incorrect output destination: &#39;</span>.$dest);
<a name="l01057"></a>01057     }
<a name="l01058"></a>01058     <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;
<a name="l01059"></a>01059 }
<a name="l01060"></a>01060 
<a name="l01061"></a>01061 <span class="comment">/*******************************************************************************</span>
<a name="l01062"></a>01062 <span class="comment">*                                                                              *</span>
<a name="l01063"></a>01063 <span class="comment">*                              Protected methods                               *</span>
<a name="l01064"></a>01064 <span class="comment">*                                                                              *</span>
<a name="l01065"></a>01065 <span class="comment">*******************************************************************************/</span>
<a name="l01066"></a>01066 <span class="keyword">function</span> _dochecks()
<a name="l01067"></a>01067 {
<a name="l01068"></a>01068     <span class="comment">//Check for locale-related bug</span>
<a name="l01069"></a>01069     <span class="keywordflow">if</span>(1.1==1)
<a name="l01070"></a>01070         $this-&gt;Error(<span class="stringliteral">&#39;Don\&#39;t alter the locale before including class file&#39;</span>);
<a name="l01071"></a>01071     <span class="comment">//Check for decimal separator</span>
<a name="l01072"></a>01072     <span class="keywordflow">if</span>(sprintf(<span class="stringliteral">&#39;%.1f&#39;</span>,1.0)!=<span class="stringliteral">&#39;1.0&#39;</span>)
<a name="l01073"></a>01073         setlocale(LC_NUMERIC,<span class="charliteral">&#39;C&#39;</span>);
<a name="l01074"></a>01074 }
<a name="l01075"></a>01075 
<a name="l01076"></a>01076 <span class="keyword">function</span> _getfontpath()
<a name="l01077"></a>01077 {
<a name="l01078"></a>01078     <span class="keywordflow">if</span>(!defined(<span class="stringliteral">&#39;FPDF_FONTPATH&#39;</span>) &amp;&amp; is_dir(dirname(__FILE__).<span class="stringliteral">&#39;/font&#39;</span>))
<a name="l01079"></a>01079         define(<span class="stringliteral">&#39;FPDF_FONTPATH&#39;</span>,dirname(__FILE__).<span class="stringliteral">&#39;/font/&#39;</span>);
<a name="l01080"></a>01080     <span class="keywordflow">return</span> defined(<span class="stringliteral">&#39;FPDF_FONTPATH&#39;</span>) ? FPDF_FONTPATH : <span class="stringliteral">&#39;&#39;</span>;
<a name="l01081"></a>01081 }
<a name="l01082"></a>01082 
<a name="l01083"></a>01083 <span class="keyword">function</span> _putpages()
<a name="l01084"></a>01084 {
<a name="l01085"></a>01085     $nb=$this-&gt;page;
<a name="l01086"></a>01086     <span class="keywordflow">if</span>(!empty($this-&gt;AliasNbPages))
<a name="l01087"></a>01087     {
<a name="l01088"></a>01088         <span class="comment">//Replace number of pages</span>
<a name="l01089"></a>01089         <span class="keywordflow">for</span>($n=1;$n&lt;=$nb;$n++)
<a name="l01090"></a>01090             $this-&gt;pages[$n]=str_replace($this-&gt;AliasNbPages,$nb,$this-&gt;pages[$n]);
<a name="l01091"></a>01091     }
<a name="l01092"></a>01092     <span class="keywordflow">if</span>($this-&gt;DefOrientation==<span class="charliteral">&#39;P&#39;</span>)
<a name="l01093"></a>01093     {
<a name="l01094"></a>01094         $wPt=$this-&gt;fwPt;
<a name="l01095"></a>01095         $hPt=$this-&gt;fhPt;
<a name="l01096"></a>01096     }
<a name="l01097"></a>01097     <span class="keywordflow">else</span>
<a name="l01098"></a>01098     {
<a name="l01099"></a>01099         $wPt=$this-&gt;fhPt;
<a name="l01100"></a>01100         $hPt=$this-&gt;fwPt;
<a name="l01101"></a>01101     }
<a name="l01102"></a>01102     $filter=($this-&gt;compress) ? <span class="stringliteral">&#39;/Filter /FlateDecode &#39;</span> : <span class="stringliteral">&#39;&#39;</span>;
<a name="l01103"></a>01103     <span class="keywordflow">for</span>($n=1;$n&lt;=$nb;$n++)
<a name="l01104"></a>01104     {
<a name="l01105"></a>01105         <span class="comment">//Page</span>
<a name="l01106"></a>01106         $this-&gt;_newobj();
<a name="l01107"></a>01107         $this-&gt;_out(<span class="stringliteral">&#39;&lt;&lt;/Type /Page&#39;</span>);
<a name="l01108"></a>01108         $this-&gt;_out(<span class="stringliteral">&#39;/Parent 1 0 R&#39;</span>);
<a name="l01109"></a>01109         <span class="keywordflow">if</span>(isset($this-&gt;OrientationChanges[$n]))
<a name="l01110"></a>01110             $this-&gt;_out(sprintf(<span class="stringliteral">&#39;/MediaBox [0 0 %.2f %.2f]&#39;</span>,$hPt,$wPt));
<a name="l01111"></a>01111         $this-&gt;_out(<span class="stringliteral">&#39;/Resources 2 0 R&#39;</span>);
<a name="l01112"></a>01112         <span class="keywordflow">if</span>(isset($this-&gt;PageLinks[$n]))
<a name="l01113"></a>01113         {
<a name="l01114"></a>01114             <span class="comment">//Links</span>
<a name="l01115"></a>01115             $annots=<span class="stringliteral">&#39;/Annots [&#39;</span>;
<a name="l01116"></a>01116             <span class="keywordflow">foreach</span>($this-&gt;PageLinks[$n] as $pl)
<a name="l01117"></a>01117             {
<a name="l01118"></a>01118                 $rect=sprintf(<span class="stringliteral">&#39;%.2f %.2f %.2f %.2f&#39;</span>,$pl[0],$pl[1],$pl[0]+$pl[2],$pl[1]-$pl[3]);
<a name="l01119"></a>01119                 $annots.=<span class="stringliteral">&#39;&lt;&lt;/Type /Annot /Subtype /Link /Rect [&#39;</span>.$rect.<span class="stringliteral">&#39;] /Border [0 0 0] &#39;</span>;
<a name="l01120"></a>01120                 <span class="keywordflow">if</span>(is_string($pl[4]))
<a name="l01121"></a>01121                     $annots.=<span class="stringliteral">&#39;/A &lt;&lt;/S /URI /URI &#39;</span>.$this-&gt;_textstring($pl[4]).<span class="stringliteral">&#39;&gt;&gt;&gt;&gt;&#39;</span>;
<a name="l01122"></a>01122                 <span class="keywordflow">else</span>
<a name="l01123"></a>01123                 {
<a name="l01124"></a>01124                     $l=$this-&gt;links[$pl[4]];
<a name="l01125"></a>01125                     $h=isset($this-&gt;OrientationChanges[$l[0]]) ? $wPt : $hPt;
<a name="l01126"></a>01126                     $annots.=sprintf(<span class="stringliteral">&#39;/Dest [%d 0 R /XYZ 0 %.2f null]&gt;&gt;&#39;</span>,1+2*$l[0],$h-$l[1]*$this-&gt;k);
<a name="l01127"></a>01127                 }
<a name="l01128"></a>01128             }
<a name="l01129"></a>01129             $this-&gt;_out($annots.<span class="charliteral">&#39;]&#39;</span>);
<a name="l01130"></a>01130         }
<a name="l01131"></a>01131         $this-&gt;_out(<span class="stringliteral">&#39;/Contents &#39;</span>.($this-&gt;n+1).<span class="stringliteral">&#39; 0 R&gt;&gt;&#39;</span>);
<a name="l01132"></a>01132         $this-&gt;_out(<span class="stringliteral">&#39;endobj&#39;</span>);
<a name="l01133"></a>01133         <span class="comment">//Page content</span>
<a name="l01134"></a>01134         $p=($this-&gt;compress) ? gzcompress($this-&gt;pages[$n]) : $this-&gt;pages[$n];
<a name="l01135"></a>01135         $this-&gt;_newobj();
<a name="l01136"></a>01136         $this-&gt;_out(<span class="stringliteral">&#39;&lt;&lt;&#39;</span>.$filter.<span class="stringliteral">&#39;/Length &#39;</span>.strlen($p).<span class="stringliteral">&#39;&gt;&gt;&#39;</span>);
<a name="l01137"></a>01137         $this-&gt;_putstream($p);
<a name="l01138"></a>01138         $this-&gt;_out(<span class="stringliteral">&#39;endobj&#39;</span>);
<a name="l01139"></a>01139     }
<a name="l01140"></a>01140     <span class="comment">//Pages root</span>
<a name="l01141"></a>01141     $this-&gt;offsets[1]=strlen($this-&gt;buffer);
<a name="l01142"></a>01142     $this-&gt;_out(<span class="stringliteral">&#39;1 0 obj&#39;</span>);
<a name="l01143"></a>01143     $this-&gt;_out(<span class="stringliteral">&#39;&lt;&lt;/Type /Pages&#39;</span>);
<a name="l01144"></a>01144     $kids=<span class="stringliteral">&#39;/Kids [&#39;</span>;
<a name="l01145"></a>01145     <span class="keywordflow">for</span>($i=0;$i&lt;$nb;$i++)
<a name="l01146"></a>01146         $kids.=(3+2*$i).<span class="stringliteral">&#39; 0 R &#39;</span>;
<a name="l01147"></a>01147     $this-&gt;_out($kids.<span class="charliteral">&#39;]&#39;</span>);
<a name="l01148"></a>01148     $this-&gt;_out(<span class="stringliteral">&#39;/Count &#39;</span>.$nb);
<a name="l01149"></a>01149     $this-&gt;_out(sprintf(<span class="stringliteral">&#39;/MediaBox [0 0 %.2f %.2f]&#39;</span>,$wPt,$hPt));
<a name="l01150"></a>01150     $this-&gt;_out(<span class="stringliteral">&#39;&gt;&gt;&#39;</span>);
<a name="l01151"></a>01151     $this-&gt;_out(<span class="stringliteral">&#39;endobj&#39;</span>);
<a name="l01152"></a>01152 }
<a name="l01153"></a>01153 
<a name="l01154"></a>01154 <span class="keyword">function</span> _putfonts()
<a name="l01155"></a>01155 {
<a name="l01156"></a>01156     $nf=$this-&gt;n;
<a name="l01157"></a>01157     <span class="keywordflow">foreach</span>($this-&gt;diffs as $diff)
<a name="l01158"></a>01158     {
<a name="l01159"></a>01159         <span class="comment">//Encodings</span>
<a name="l01160"></a>01160         $this-&gt;_newobj();
<a name="l01161"></a>01161         $this-&gt;_out(<span class="stringliteral">&#39;&lt;&lt;/Type /Encoding /BaseEncoding /WinAnsiEncoding /Differences [&#39;</span>.$diff.<span class="stringliteral">&#39;]&gt;&gt;&#39;</span>);
<a name="l01162"></a>01162         $this-&gt;_out(<span class="stringliteral">&#39;endobj&#39;</span>);
<a name="l01163"></a>01163     }
<a name="l01164"></a>01164     $mqr=get_magic_quotes_runtime();
<a name="l01165"></a>01165     <span class="keywordflow">if</span>(get_magic_quotes_runtime())
<a name="l01166"></a>01166     {
<a name="l01167"></a>01167         set_magic_quotes_runtime(0);
<a name="l01168"></a>01168     }
<a name="l01169"></a>01169     <span class="keywordflow">foreach</span>($this-&gt;FontFiles as $file=&gt;$info)
<a name="l01170"></a>01170     {
<a name="l01171"></a>01171         <span class="comment">//Font file embedding</span>
<a name="l01172"></a>01172         $this-&gt;_newobj();
<a name="l01173"></a>01173         $this-&gt;FontFiles[$file][<span class="charliteral">&#39;n&#39;</span>]=$this-&gt;n;
<a name="l01174"></a>01174         $font=<span class="stringliteral">&#39;&#39;</span>;
<a name="l01175"></a>01175         $f=fopen($this-&gt;_getfontpath().$file,<span class="stringliteral">&#39;rb&#39;</span>,1);
<a name="l01176"></a>01176         <span class="keywordflow">if</span>(!$f)
<a name="l01177"></a>01177             $this-&gt;Error(<span class="stringliteral">&#39;Font file not found&#39;</span>);
<a name="l01178"></a>01178         <span class="keywordflow">while</span>(!feof($f))
<a name="l01179"></a>01179             $font.=fread($f,8192);
<a name="l01180"></a>01180         fclose($f);
<a name="l01181"></a>01181         $compressed=(substr($file,-2)==<span class="stringliteral">&#39;.z&#39;</span>);
<a name="l01182"></a>01182         <span class="keywordflow">if</span>(!$compressed &amp;&amp; isset($info[<span class="stringliteral">&#39;length2&#39;</span>]))
<a name="l01183"></a>01183         {
<a name="l01184"></a>01184             $header=(ord($font{0})==128);
<a name="l01185"></a>01185             <span class="keywordflow">if</span>($header)
<a name="l01186"></a>01186             {
<a name="l01187"></a>01187                 <span class="comment">//Strip first binary header</span>
<a name="l01188"></a>01188                 $font=substr($font,6);
<a name="l01189"></a>01189             }
<a name="l01190"></a>01190             <span class="keywordflow">if</span>($header &amp;&amp; ord($font{$info[<span class="stringliteral">&#39;length1&#39;</span>]})==128)
<a name="l01191"></a>01191             {
<a name="l01192"></a>01192                 <span class="comment">//Strip second binary header</span>
<a name="l01193"></a>01193                 $font=substr($font,0,$info[<span class="stringliteral">&#39;length1&#39;</span>]).substr($font,$info[<span class="stringliteral">&#39;length1&#39;</span>]+6);
<a name="l01194"></a>01194             }
<a name="l01195"></a>01195         }
<a name="l01196"></a>01196         $this-&gt;_out(<span class="stringliteral">&#39;&lt;&lt;/Length &#39;</span>.strlen($font));
<a name="l01197"></a>01197         <span class="keywordflow">if</span>($compressed)
<a name="l01198"></a>01198             $this-&gt;_out(<span class="stringliteral">&#39;/Filter /FlateDecode&#39;</span>);
<a name="l01199"></a>01199         $this-&gt;_out(<span class="stringliteral">&#39;/Length1 &#39;</span>.$info[<span class="stringliteral">&#39;length1&#39;</span>]);
<a name="l01200"></a>01200         <span class="keywordflow">if</span>(isset($info[<span class="stringliteral">&#39;length2&#39;</span>]))
<a name="l01201"></a>01201             $this-&gt;_out(<span class="stringliteral">&#39;/Length2 &#39;</span>.$info[<span class="stringliteral">&#39;length2&#39;</span>].<span class="stringliteral">&#39; /Length3 0&#39;</span>);
<a name="l01202"></a>01202         $this-&gt;_out(<span class="stringliteral">&#39;&gt;&gt;&#39;</span>);
<a name="l01203"></a>01203         $this-&gt;_putstream($font);
<a name="l01204"></a>01204         $this-&gt;_out(<span class="stringliteral">&#39;endobj&#39;</span>);
<a name="l01205"></a>01205     }
<a name="l01206"></a>01206     <span class="keywordflow">foreach</span>($this-&gt;fonts as $k=&gt;$font)
<a name="l01207"></a>01207     {
<a name="l01208"></a>01208         <span class="comment">//Font objects</span>
<a name="l01209"></a>01209         $this-&gt;fonts[$k][<span class="charliteral">&#39;n&#39;</span>]=$this-&gt;n+1;
<a name="l01210"></a>01210         $type=$font[<span class="stringliteral">&#39;type&#39;</span>];
<a name="l01211"></a>01211         $name=$font[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l01212"></a>01212         <span class="keywordflow">if</span>($type==<span class="stringliteral">&#39;core&#39;</span>)
<a name="l01213"></a>01213         {
<a name="l01214"></a>01214             <span class="comment">//Standard font</span>
<a name="l01215"></a>01215             $this-&gt;_newobj();
<a name="l01216"></a>01216             $this-&gt;_out(<span class="stringliteral">&#39;&lt;&lt;/Type /Font&#39;</span>);
<a name="l01217"></a>01217             $this-&gt;_out(<span class="stringliteral">&#39;/BaseFont /&#39;</span>.$name);
<a name="l01218"></a>01218             $this-&gt;_out(<span class="stringliteral">&#39;/Subtype /Type1&#39;</span>);
<a name="l01219"></a>01219             <span class="keywordflow">if</span>($name!=<span class="stringliteral">&#39;Symbol&#39;</span> &amp;&amp; $name!=<span class="stringliteral">&#39;ZapfDingbats&#39;</span>)
<a name="l01220"></a>01220                 $this-&gt;_out(<span class="stringliteral">&#39;/Encoding /WinAnsiEncoding&#39;</span>);
<a name="l01221"></a>01221             $this-&gt;_out(<span class="stringliteral">&#39;&gt;&gt;&#39;</span>);
<a name="l01222"></a>01222             $this-&gt;_out(<span class="stringliteral">&#39;endobj&#39;</span>);
<a name="l01223"></a>01223         }
<a name="l01224"></a>01224         elseif($type==<span class="stringliteral">&#39;Type1&#39;</span> || $type==<span class="stringliteral">&#39;TrueType&#39;</span>)
<a name="l01225"></a>01225         {
<a name="l01226"></a>01226             <span class="comment">//Additional Type1 or TrueType font</span>
<a name="l01227"></a>01227             $this-&gt;_newobj();
<a name="l01228"></a>01228             $this-&gt;_out(<span class="stringliteral">&#39;&lt;&lt;/Type /Font&#39;</span>);
<a name="l01229"></a>01229             $this-&gt;_out(<span class="stringliteral">&#39;/BaseFont /&#39;</span>.$name);
<a name="l01230"></a>01230             $this-&gt;_out(<span class="stringliteral">&#39;/Subtype /&#39;</span>.$type);
<a name="l01231"></a>01231             $this-&gt;_out(<span class="stringliteral">&#39;/FirstChar 32 /LastChar 255&#39;</span>);
<a name="l01232"></a>01232             $this-&gt;_out(<span class="stringliteral">&#39;/Widths &#39;</span>.($this-&gt;n+1).<span class="stringliteral">&#39; 0 R&#39;</span>);
<a name="l01233"></a>01233             $this-&gt;_out(<span class="stringliteral">&#39;/FontDescriptor &#39;</span>.($this-&gt;n+2).<span class="stringliteral">&#39; 0 R&#39;</span>);
<a name="l01234"></a>01234             <span class="keywordflow">if</span>($font[<span class="stringliteral">&#39;enc&#39;</span>])
<a name="l01235"></a>01235             {
<a name="l01236"></a>01236                 <span class="keywordflow">if</span>(isset($font[<span class="stringliteral">&#39;diff&#39;</span>]))
<a name="l01237"></a>01237                     $this-&gt;_out(<span class="stringliteral">&#39;/Encoding &#39;</span>.($nf+$font[<span class="stringliteral">&#39;diff&#39;</span>]).<span class="stringliteral">&#39; 0 R&#39;</span>);
<a name="l01238"></a>01238                 <span class="keywordflow">else</span>
<a name="l01239"></a>01239                     $this-&gt;_out(<span class="stringliteral">&#39;/Encoding /WinAnsiEncoding&#39;</span>);
<a name="l01240"></a>01240             }
<a name="l01241"></a>01241             $this-&gt;_out(<span class="stringliteral">&#39;&gt;&gt;&#39;</span>);
<a name="l01242"></a>01242             $this-&gt;_out(<span class="stringliteral">&#39;endobj&#39;</span>);
<a name="l01243"></a>01243             <span class="comment">//Widths</span>
<a name="l01244"></a>01244             $this-&gt;_newobj();
<a name="l01245"></a>01245             $cw=&amp;$font[<span class="stringliteral">&#39;cw&#39;</span>];
<a name="l01246"></a>01246             $s=<span class="charliteral">&#39;[&#39;</span>;
<a name="l01247"></a>01247             <span class="keywordflow">for</span>($i=32;$i&lt;=255;$i++)
<a name="l01248"></a>01248                 $s.=$cw[chr($i)].<span class="charliteral">&#39; &#39;</span>;
<a name="l01249"></a>01249             $this-&gt;_out($s.<span class="charliteral">&#39;]&#39;</span>);
<a name="l01250"></a>01250             $this-&gt;_out(<span class="stringliteral">&#39;endobj&#39;</span>);
<a name="l01251"></a>01251             <span class="comment">//Descriptor</span>
<a name="l01252"></a>01252             $this-&gt;_newobj();
<a name="l01253"></a>01253             $s=<span class="stringliteral">&#39;&lt;&lt;/Type /FontDescriptor /FontName /&#39;</span>.$name;
<a name="l01254"></a>01254             <span class="keywordflow">foreach</span>($font[<span class="stringliteral">&#39;desc&#39;</span>] as $k=&gt;$v)
<a name="l01255"></a>01255                 $s.=<span class="stringliteral">&#39; /&#39;</span>.$k.<span class="charliteral">&#39; &#39;</span>.$v;
<a name="l01256"></a>01256             $file=$font[<span class="stringliteral">&#39;file&#39;</span>];
<a name="l01257"></a>01257             <span class="keywordflow">if</span>($file)
<a name="l01258"></a>01258                 $s.=<span class="stringliteral">&#39; /FontFile&#39;</span>.($type==<span class="stringliteral">&#39;Type1&#39;</span> ? <span class="stringliteral">&#39;&#39;</span> : <span class="charliteral">&#39;2&#39;</span>).<span class="charliteral">&#39; &#39;</span>.$this-&gt;FontFiles[$file][<span class="charliteral">&#39;n&#39;</span>].<span class="stringliteral">&#39; 0 R&#39;</span>;
<a name="l01259"></a>01259             $this-&gt;_out($s.<span class="stringliteral">&#39;&gt;&gt;&#39;</span>);
<a name="l01260"></a>01260             $this-&gt;_out(<span class="stringliteral">&#39;endobj&#39;</span>);
<a name="l01261"></a>01261         }
<a name="l01262"></a>01262         <span class="keywordflow">else</span>
<a name="l01263"></a>01263         {
<a name="l01264"></a>01264             <span class="comment">//Allow for additional types</span>
<a name="l01265"></a>01265             $mtd=<span class="stringliteral">&#39;_put&#39;</span>.strtolower($type);
<a name="l01266"></a>01266             <span class="keywordflow">if</span>(!method_exists($this,$mtd))
<a name="l01267"></a>01267                 $this-&gt;Error(<span class="stringliteral">&#39;Unsupported font type: &#39;</span>.$type);
<a name="l01268"></a>01268             $this-&gt;$mtd($font);
<a name="l01269"></a>01269         }
<a name="l01270"></a>01270     }
<a name="l01271"></a>01271 }
<a name="l01272"></a>01272 
<a name="l01273"></a>01273 <span class="keyword">function</span> _putimages()
<a name="l01274"></a>01274 {
<a name="l01275"></a>01275     $filter=($this-&gt;compress) ? <span class="stringliteral">&#39;/Filter /FlateDecode &#39;</span> : <span class="stringliteral">&#39;&#39;</span>;
<a name="l01276"></a>01276     reset($this-&gt;images);
<a name="l01277"></a>01277     <span class="keywordflow">while</span>(list($file,$info)=each($this-&gt;images))
<a name="l01278"></a>01278     {
<a name="l01279"></a>01279         $this-&gt;_newobj();
<a name="l01280"></a>01280         $this-&gt;images[$file][<span class="charliteral">&#39;n&#39;</span>]=$this-&gt;n;
<a name="l01281"></a>01281         $this-&gt;_out(<span class="stringliteral">&#39;&lt;&lt;/Type /XObject&#39;</span>);
<a name="l01282"></a>01282         $this-&gt;_out(<span class="stringliteral">&#39;/Subtype /Image&#39;</span>);
<a name="l01283"></a>01283         $this-&gt;_out(<span class="stringliteral">&#39;/Width &#39;</span>.$info[<span class="charliteral">&#39;w&#39;</span>]);
<a name="l01284"></a>01284         $this-&gt;_out(<span class="stringliteral">&#39;/Height &#39;</span>.$info[<span class="charliteral">&#39;h&#39;</span>]);
<a name="l01285"></a>01285         <span class="keywordflow">if</span>($info[<span class="stringliteral">&#39;cs&#39;</span>]==<span class="stringliteral">&#39;Indexed&#39;</span>)
<a name="l01286"></a>01286             $this-&gt;_out(<span class="stringliteral">&#39;/ColorSpace [/Indexed /DeviceRGB &#39;</span>.(strlen($info[<span class="stringliteral">&#39;pal&#39;</span>])/3-1).<span class="charliteral">&#39; &#39;</span>.($this-&gt;n+1).<span class="stringliteral">&#39; 0 R]&#39;</span>);
<a name="l01287"></a>01287         <span class="keywordflow">else</span>
<a name="l01288"></a>01288         {
<a name="l01289"></a>01289             $this-&gt;_out(<span class="stringliteral">&#39;/ColorSpace /&#39;</span>.$info[<span class="stringliteral">&#39;cs&#39;</span>]);
<a name="l01290"></a>01290             <span class="keywordflow">if</span>($info[<span class="stringliteral">&#39;cs&#39;</span>]==<span class="stringliteral">&#39;DeviceCMYK&#39;</span>)
<a name="l01291"></a>01291                 $this-&gt;_out(<span class="stringliteral">&#39;/Decode [1 0 1 0 1 0 1 0]&#39;</span>);
<a name="l01292"></a>01292         }
<a name="l01293"></a>01293         $this-&gt;_out(<span class="stringliteral">&#39;/BitsPerComponent &#39;</span>.$info[<span class="stringliteral">&#39;bpc&#39;</span>]);
<a name="l01294"></a>01294         <span class="keywordflow">if</span>(isset($info[<span class="charliteral">&#39;f&#39;</span>]))
<a name="l01295"></a>01295             $this-&gt;_out(<span class="stringliteral">&#39;/Filter /&#39;</span>.$info[<span class="charliteral">&#39;f&#39;</span>]);
<a name="l01296"></a>01296         <span class="keywordflow">if</span>(isset($info[<span class="stringliteral">&#39;parms&#39;</span>]))
<a name="l01297"></a>01297             $this-&gt;_out($info[<span class="stringliteral">&#39;parms&#39;</span>]);
<a name="l01298"></a>01298         <span class="keywordflow">if</span>(isset($info[<span class="stringliteral">&#39;trns&#39;</span>]) &amp;&amp; is_array($info[<span class="stringliteral">&#39;trns&#39;</span>]))
<a name="l01299"></a>01299         {
<a name="l01300"></a>01300             $trns=<span class="stringliteral">&#39;&#39;</span>;
<a name="l01301"></a>01301             <span class="keywordflow">for</span>($i=0;$i&lt;count($info[<span class="stringliteral">&#39;trns&#39;</span>]);$i++)
<a name="l01302"></a>01302                 $trns.=$info[<span class="stringliteral">&#39;trns&#39;</span>][$i].<span class="charliteral">&#39; &#39;</span>.$info[<span class="stringliteral">&#39;trns&#39;</span>][$i].<span class="charliteral">&#39; &#39;</span>;
<a name="l01303"></a>01303             $this-&gt;_out(<span class="stringliteral">&#39;/Mask [&#39;</span>.$trns.<span class="charliteral">&#39;]&#39;</span>);
<a name="l01304"></a>01304         }
<a name="l01305"></a>01305         $this-&gt;_out(<span class="stringliteral">&#39;/Length &#39;</span>.strlen($info[<span class="stringliteral">&#39;data&#39;</span>]).<span class="stringliteral">&#39;&gt;&gt;&#39;</span>);
<a name="l01306"></a>01306         $this-&gt;_putstream($info[<span class="stringliteral">&#39;data&#39;</span>]);
<a name="l01307"></a>01307         unset($this-&gt;images[$file][<span class="stringliteral">&#39;data&#39;</span>]);
<a name="l01308"></a>01308         $this-&gt;_out(<span class="stringliteral">&#39;endobj&#39;</span>);
<a name="l01309"></a>01309         <span class="comment">//Palette</span>
<a name="l01310"></a>01310         <span class="keywordflow">if</span>($info[<span class="stringliteral">&#39;cs&#39;</span>]==<span class="stringliteral">&#39;Indexed&#39;</span>)
<a name="l01311"></a>01311         {
<a name="l01312"></a>01312             $this-&gt;_newobj();
<a name="l01313"></a>01313             $pal=($this-&gt;compress) ? gzcompress($info[<span class="stringliteral">&#39;pal&#39;</span>]) : $info[<span class="stringliteral">&#39;pal&#39;</span>];
<a name="l01314"></a>01314             $this-&gt;_out(<span class="stringliteral">&#39;&lt;&lt;&#39;</span>.$filter.<span class="stringliteral">&#39;/Length &#39;</span>.strlen($pal).<span class="stringliteral">&#39;&gt;&gt;&#39;</span>);
<a name="l01315"></a>01315             $this-&gt;_putstream($pal);
<a name="l01316"></a>01316             $this-&gt;_out(<span class="stringliteral">&#39;endobj&#39;</span>);
<a name="l01317"></a>01317         }
<a name="l01318"></a>01318     }
<a name="l01319"></a>01319 }
<a name="l01320"></a>01320 
<a name="l01321"></a>01321 <span class="keyword">function</span> _putxobjectdict()
<a name="l01322"></a>01322 {
<a name="l01323"></a>01323     <span class="keywordflow">foreach</span>($this-&gt;images as $image)
<a name="l01324"></a>01324         $this-&gt;_out(<span class="stringliteral">&#39;/I&#39;</span>.$image[<span class="charliteral">&#39;i&#39;</span>].<span class="charliteral">&#39; &#39;</span>.$image[<span class="charliteral">&#39;n&#39;</span>].<span class="stringliteral">&#39; 0 R&#39;</span>);
<a name="l01325"></a>01325 }
<a name="l01326"></a>01326 
<a name="l01327"></a>01327 <span class="keyword">function</span> _putresourcedict()
<a name="l01328"></a>01328 {
<a name="l01329"></a>01329     $this-&gt;_out(<span class="stringliteral">&#39;/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]&#39;</span>);
<a name="l01330"></a>01330     $this-&gt;_out(<span class="stringliteral">&#39;/Font &lt;&lt;&#39;</span>);
<a name="l01331"></a>01331     <span class="keywordflow">foreach</span>($this-&gt;fonts as $font)
<a name="l01332"></a>01332         $this-&gt;_out(<span class="stringliteral">&#39;/F&#39;</span>.$font[<span class="charliteral">&#39;i&#39;</span>].<span class="charliteral">&#39; &#39;</span>.$font[<span class="charliteral">&#39;n&#39;</span>].<span class="stringliteral">&#39; 0 R&#39;</span>);
<a name="l01333"></a>01333     $this-&gt;_out(<span class="stringliteral">&#39;&gt;&gt;&#39;</span>);
<a name="l01334"></a>01334     $this-&gt;_out(<span class="stringliteral">&#39;/XObject &lt;&lt;&#39;</span>);
<a name="l01335"></a>01335     $this-&gt;_putxobjectdict();
<a name="l01336"></a>01336     $this-&gt;_out(<span class="stringliteral">&#39;&gt;&gt;&#39;</span>);
<a name="l01337"></a>01337 }
<a name="l01338"></a>01338 
<a name="l01339"></a>01339 <span class="keyword">function</span> _putresources()
<a name="l01340"></a>01340 {
<a name="l01341"></a>01341     $this-&gt;_putfonts();
<a name="l01342"></a>01342     $this-&gt;_putimages();
<a name="l01343"></a>01343     <span class="comment">//Resource dictionary</span>
<a name="l01344"></a>01344     $this-&gt;offsets[2]=strlen($this-&gt;buffer);
<a name="l01345"></a>01345     $this-&gt;_out(<span class="stringliteral">&#39;2 0 obj&#39;</span>);
<a name="l01346"></a>01346     $this-&gt;_out(<span class="stringliteral">&#39;&lt;&lt;&#39;</span>);
<a name="l01347"></a>01347     $this-&gt;_putresourcedict();
<a name="l01348"></a>01348     $this-&gt;_out(<span class="stringliteral">&#39;&gt;&gt;&#39;</span>);
<a name="l01349"></a>01349     $this-&gt;_out(<span class="stringliteral">&#39;endobj&#39;</span>);
<a name="l01350"></a>01350 }
<a name="l01351"></a>01351 
<a name="l01352"></a>01352 <span class="keyword">function</span> _putinfo()
<a name="l01353"></a>01353 {
<a name="l01354"></a>01354     $this-&gt;_out(<span class="stringliteral">&#39;/Producer &#39;</span>.$this-&gt;_textstring(<span class="stringliteral">&#39;FPDF &#39;</span>.FPDF_VERSION));
<a name="l01355"></a>01355     <span class="keywordflow">if</span>(!empty($this-&gt;title))
<a name="l01356"></a>01356         $this-&gt;_out(<span class="stringliteral">&#39;/Title &#39;</span>.$this-&gt;_textstring($this-&gt;title));
<a name="l01357"></a>01357     <span class="keywordflow">if</span>(!empty($this-&gt;subject))
<a name="l01358"></a>01358         $this-&gt;_out(<span class="stringliteral">&#39;/Subject &#39;</span>.$this-&gt;_textstring($this-&gt;subject));
<a name="l01359"></a>01359     <span class="keywordflow">if</span>(!empty($this-&gt;author))
<a name="l01360"></a>01360         $this-&gt;_out(<span class="stringliteral">&#39;/Author &#39;</span>.$this-&gt;_textstring($this-&gt;author));
<a name="l01361"></a>01361     <span class="keywordflow">if</span>(!empty($this-&gt;keywords))
<a name="l01362"></a>01362         $this-&gt;_out(<span class="stringliteral">&#39;/Keywords &#39;</span>.$this-&gt;_textstring($this-&gt;keywords));
<a name="l01363"></a>01363     <span class="keywordflow">if</span>(!empty($this-&gt;creator))
<a name="l01364"></a>01364         $this-&gt;_out(<span class="stringliteral">&#39;/Creator &#39;</span>.$this-&gt;_textstring($this-&gt;creator));
<a name="l01365"></a>01365     $this-&gt;_out(<span class="stringliteral">&#39;/CreationDate &#39;</span>.$this-&gt;_textstring(<span class="stringliteral">&#39;D:&#39;</span>.date(<span class="stringliteral">&#39;YmdHis&#39;</span>)));
<a name="l01366"></a>01366 }
<a name="l01367"></a>01367 
<a name="l01368"></a>01368 <span class="keyword">function</span> _putcatalog()
<a name="l01369"></a>01369 {
<a name="l01370"></a>01370     $this-&gt;_out(<span class="stringliteral">&#39;/Type /Catalog&#39;</span>);
<a name="l01371"></a>01371     $this-&gt;_out(<span class="stringliteral">&#39;/Pages 1 0 R&#39;</span>);
<a name="l01372"></a>01372     <span class="keywordflow">if</span>($this-&gt;ZoomMode==<span class="stringliteral">&#39;fullpage&#39;</span>)
<a name="l01373"></a>01373         $this-&gt;_out(<span class="stringliteral">&#39;/OpenAction [3 0 R /Fit]&#39;</span>);
<a name="l01374"></a>01374     elseif($this-&gt;ZoomMode==<span class="stringliteral">&#39;fullwidth&#39;</span>)
<a name="l01375"></a>01375         $this-&gt;_out(&#39;/OpenAction [3 0 R /FitH null]&#39;);
<a name="l01376"></a>01376     elseif($this-&gt;ZoomMode==&#39;real&#39;)
<a name="l01377"></a>01377         $this-&gt;_out(&#39;/OpenAction [3 0 R /XYZ null null 1]&#39;);
<a name="l01378"></a>01378     elseif(!is_string($this-&gt;ZoomMode))
<a name="l01379"></a>01379         $this-&gt;_out(&#39;/OpenAction [3 0 R /XYZ null null &#39;.($this-&gt;ZoomMode/100).&#39;]&#39;);
<a name="l01380"></a>01380     <a class="code" href="admin__panel_8php.html#acdfe0026633f5372cbc1954f91109f30">if</a>($this-&gt;LayoutMode==&#39;single&#39;)
<a name="l01381"></a>01381         $this-&gt;_out(&#39;/PageLayout /SinglePage&#39;);
<a name="l01382"></a>01382     elseif($this-&gt;LayoutMode==&#39;continuous&#39;)
<a name="l01383"></a>01383         $this-&gt;_out(&#39;/PageLayout /OneColumn&#39;);
<a name="l01384"></a>01384     elseif($this-&gt;LayoutMode==&#39;two&#39;)
<a name="l01385"></a>01385         $this-&gt;_out(&#39;/PageLayout /TwoColumnLeft&#39;);
<a name="l01386"></a>01386 }
<a name="l01387"></a>01387 
<a name="l01388"></a>01388 function _putheader()
<a name="l01389"></a>01389 {
<a name="l01390"></a>01390     $this-&gt;_out(<span class="stringliteral">&#39;%PDF-&#39;</span>.$this-&gt;PDFVersion);
<a name="l01391"></a>01391 }
<a name="l01392"></a>01392 
<a name="l01393"></a>01393 <span class="keyword">function</span> _puttrailer()
<a name="l01394"></a>01394 {
<a name="l01395"></a>01395     $this-&gt;_out(<span class="stringliteral">&#39;/Size &#39;</span>.($this-&gt;n+1));
<a name="l01396"></a>01396     $this-&gt;_out(<span class="stringliteral">&#39;/Root &#39;</span>.$this-&gt;n.<span class="stringliteral">&#39; 0 R&#39;</span>);
<a name="l01397"></a>01397     $this-&gt;_out(<span class="stringliteral">&#39;/Info &#39;</span>.($this-&gt;n-1).<span class="stringliteral">&#39; 0 R&#39;</span>);
<a name="l01398"></a>01398 }
<a name="l01399"></a>01399 
<a name="l01400"></a>01400 <span class="keyword">function</span> _enddoc()
<a name="l01401"></a>01401 {
<a name="l01402"></a>01402     $this-&gt;_putheader();
<a name="l01403"></a>01403     $this-&gt;_putpages();
<a name="l01404"></a>01404     $this-&gt;_putresources();
<a name="l01405"></a>01405     <span class="comment">//Info</span>
<a name="l01406"></a>01406     $this-&gt;_newobj();
<a name="l01407"></a>01407     $this-&gt;_out(<span class="stringliteral">&#39;&lt;&lt;&#39;</span>);
<a name="l01408"></a>01408     $this-&gt;_putinfo();
<a name="l01409"></a>01409     $this-&gt;_out(<span class="stringliteral">&#39;&gt;&gt;&#39;</span>);
<a name="l01410"></a>01410     $this-&gt;_out(<span class="stringliteral">&#39;endobj&#39;</span>);
<a name="l01411"></a>01411     <span class="comment">//Catalog</span>
<a name="l01412"></a>01412     $this-&gt;_newobj();
<a name="l01413"></a>01413     $this-&gt;_out(<span class="stringliteral">&#39;&lt;&lt;&#39;</span>);
<a name="l01414"></a>01414     $this-&gt;_putcatalog();
<a name="l01415"></a>01415     $this-&gt;_out(<span class="stringliteral">&#39;&gt;&gt;&#39;</span>);
<a name="l01416"></a>01416     $this-&gt;_out(<span class="stringliteral">&#39;endobj&#39;</span>);
<a name="l01417"></a>01417     <span class="comment">//Cross-ref</span>
<a name="l01418"></a>01418     $o=strlen($this-&gt;buffer);
<a name="l01419"></a>01419     $this-&gt;_out(<span class="stringliteral">&#39;xref&#39;</span>);
<a name="l01420"></a>01420     $this-&gt;_out(<span class="stringliteral">&#39;0 &#39;</span>.($this-&gt;n+1));
<a name="l01421"></a>01421     $this-&gt;_out(<span class="stringliteral">&#39;0000000000 65535 f &#39;</span>);
<a name="l01422"></a>01422     <span class="keywordflow">for</span>($i=1;$i&lt;=$this-&gt;n;$i++)
<a name="l01423"></a>01423         $this-&gt;_out(sprintf(<span class="stringliteral">&#39;%010d 00000 n &#39;</span>,$this-&gt;offsets[$i]));
<a name="l01424"></a>01424     <span class="comment">//Trailer</span>
<a name="l01425"></a>01425     $this-&gt;_out(<span class="stringliteral">&#39;trailer&#39;</span>);
<a name="l01426"></a>01426     $this-&gt;_out(<span class="stringliteral">&#39;&lt;&lt;&#39;</span>);
<a name="l01427"></a>01427     $this-&gt;_puttrailer();
<a name="l01428"></a>01428     $this-&gt;_out(<span class="stringliteral">&#39;&gt;&gt;&#39;</span>);
<a name="l01429"></a>01429     $this-&gt;_out(<span class="stringliteral">&#39;startxref&#39;</span>);
<a name="l01430"></a>01430     $this-&gt;_out($o);
<a name="l01431"></a>01431     $this-&gt;_out(<span class="stringliteral">&#39;%%EOF&#39;</span>);
<a name="l01432"></a>01432     $this-&gt;state=3;
<a name="l01433"></a>01433 }
<a name="l01434"></a>01434 
<a name="l01435"></a>01435 <span class="keyword">function</span> _beginpage($orientation)
<a name="l01436"></a>01436 {
<a name="l01437"></a>01437     $this-&gt;page++;
<a name="l01438"></a>01438     $this-&gt;pages[$this-&gt;page]=<span class="stringliteral">&#39;&#39;</span>;
<a name="l01439"></a>01439     $this-&gt;state=2;
<a name="l01440"></a>01440     $this-&gt;x=$this-&gt;lMargin;
<a name="l01441"></a>01441     $this-&gt;y=$this-&gt;tMargin;
<a name="l01442"></a>01442     $this-&gt;FontFamily=<span class="stringliteral">&#39;&#39;</span>;
<a name="l01443"></a>01443     <span class="comment">//Page orientation</span>
<a name="l01444"></a>01444     <span class="keywordflow">if</span>(!$orientation)
<a name="l01445"></a>01445         $orientation=$this-&gt;DefOrientation;
<a name="l01446"></a>01446     <span class="keywordflow">else</span>
<a name="l01447"></a>01447     {
<a name="l01448"></a>01448         $orientation=strtoupper($orientation{0});
<a name="l01449"></a>01449         <span class="keywordflow">if</span>($orientation!=$this-&gt;DefOrientation)
<a name="l01450"></a>01450             $this-&gt;OrientationChanges[$this-&gt;page]=<span class="keyword">true</span>;
<a name="l01451"></a>01451     }
<a name="l01452"></a>01452     <span class="keywordflow">if</span>($orientation!=$this-&gt;CurOrientation)
<a name="l01453"></a>01453     {
<a name="l01454"></a>01454         <span class="comment">//Change orientation</span>
<a name="l01455"></a>01455         <span class="keywordflow">if</span>($orientation==<span class="charliteral">&#39;P&#39;</span>)
<a name="l01456"></a>01456         {
<a name="l01457"></a>01457             $this-&gt;wPt=$this-&gt;fwPt;
<a name="l01458"></a>01458             $this-&gt;hPt=$this-&gt;fhPt;
<a name="l01459"></a>01459             $this-&gt;w=$this-&gt;fw;
<a name="l01460"></a>01460             $this-&gt;h=$this-&gt;fh;
<a name="l01461"></a>01461         }
<a name="l01462"></a>01462         <span class="keywordflow">else</span>
<a name="l01463"></a>01463         {
<a name="l01464"></a>01464             $this-&gt;wPt=$this-&gt;fhPt;
<a name="l01465"></a>01465             $this-&gt;hPt=$this-&gt;fwPt;
<a name="l01466"></a>01466             $this-&gt;w=$this-&gt;fh;
<a name="l01467"></a>01467             $this-&gt;h=$this-&gt;fw;
<a name="l01468"></a>01468         }
<a name="l01469"></a>01469         $this-&gt;PageBreakTrigger=$this-&gt;h-$this-&gt;bMargin;
<a name="l01470"></a>01470         $this-&gt;CurOrientation=$orientation;
<a name="l01471"></a>01471     }
<a name="l01472"></a>01472 }
<a name="l01473"></a>01473 
<a name="l01474"></a>01474 <span class="keyword">function</span> _endpage()
<a name="l01475"></a>01475 {
<a name="l01476"></a>01476     <span class="comment">//End of page contents</span>
<a name="l01477"></a>01477     $this-&gt;state=1;
<a name="l01478"></a>01478 }
<a name="l01479"></a>01479 
<a name="l01480"></a>01480 <span class="keyword">function</span> _newobj()
<a name="l01481"></a>01481 {
<a name="l01482"></a>01482     <span class="comment">//Begin a new object</span>
<a name="l01483"></a>01483     $this-&gt;n++;
<a name="l01484"></a>01484     $this-&gt;offsets[$this-&gt;n]=strlen($this-&gt;buffer);
<a name="l01485"></a>01485     $this-&gt;_out($this-&gt;n.<span class="stringliteral">&#39; 0 obj&#39;</span>);
<a name="l01486"></a>01486 }
<a name="l01487"></a>01487 
<a name="l01488"></a>01488 <span class="keyword">function</span> _dounderline($x,$y,$txt)
<a name="l01489"></a>01489 {
<a name="l01490"></a>01490     <span class="comment">//Underline text</span>
<a name="l01491"></a>01491     $up=$this-&gt;CurrentFont[<span class="stringliteral">&#39;up&#39;</span>];
<a name="l01492"></a>01492     $ut=$this-&gt;CurrentFont[<span class="stringliteral">&#39;ut&#39;</span>];
<a name="l01493"></a>01493     $w=$this-&gt;GetStringWidth($txt)+$this-&gt;ws*substr_count($txt,<span class="charliteral">&#39; &#39;</span>);
<a name="l01494"></a>01494     <span class="keywordflow">return</span> sprintf(<span class="stringliteral">&#39;%.2f %.2f %.2f %.2f re f&#39;</span>,$x*$this-&gt;k,($this-&gt;h-($y-$up/1000*$this-&gt;FontSize))*$this-&gt;k,$w*$this-&gt;k,-$ut/1000*$this-&gt;FontSizePt);
<a name="l01495"></a>01495 }
<a name="l01496"></a>01496 
<a name="l01497"></a>01497 <span class="keyword">function</span> _parsejpg($file)
<a name="l01498"></a>01498 {
<a name="l01499"></a>01499     <span class="comment">//Extract info from a JPEG file</span>
<a name="l01500"></a>01500     $a=GetImageSize($file);
<a name="l01501"></a>01501     <span class="keywordflow">if</span>(!$a)
<a name="l01502"></a>01502         $this-&gt;Error(<span class="stringliteral">&#39;Missing or incorrect image file: &#39;</span>.$file);
<a name="l01503"></a>01503     <span class="keywordflow">if</span>($a[2]!=2)
<a name="l01504"></a>01504         $this-&gt;Error(<span class="stringliteral">&#39;Not a JPEG file: &#39;</span>.$file);
<a name="l01505"></a>01505     <span class="keywordflow">if</span>(!isset($a[<span class="stringliteral">&#39;channels&#39;</span>]) || $a[<span class="stringliteral">&#39;channels&#39;</span>]==3)
<a name="l01506"></a>01506         $colspace=<span class="stringliteral">&#39;DeviceRGB&#39;</span>;
<a name="l01507"></a>01507     elseif($a[<span class="stringliteral">&#39;channels&#39;</span>]==4)
<a name="l01508"></a>01508         $colspace=&#39;DeviceCMYK&#39;;
<a name="l01509"></a>01509     else
<a name="l01510"></a>01510         $colspace=&#39;DeviceGray&#39;;
<a name="l01511"></a>01511     $bpc=isset($a[&#39;bits&#39;]) ? $a[&#39;bits&#39;] : 8;
<a name="l01512"></a>01512     <span class="comment">//Read whole file</span>
<a name="l01513"></a>01513     $f=fopen($file,&#39;rb&#39;);
<a name="l01514"></a>01514     $data=&#39;&#39;;
<a name="l01515"></a>01515     while(!feof($f))
<a name="l01516"></a>01516         $data.=fread($f,4096);
<a name="l01517"></a>01517     fclose($f);
<a name="l01518"></a>01518     return array(&#39;w&#39;=&gt;$a[0],&#39;h&#39;=&gt;$a[1],&#39;cs&#39;=&gt;$colspace,&#39;bpc&#39;=&gt;$bpc,&#39;f&#39;=&gt;&#39;DCTDecode&#39;,&#39;data&#39;=&gt;$data);
<a name="l01519"></a>01519 }
<a name="l01520"></a>01520 
<a name="l01521"></a>01521 function _parsepng($file)
<a name="l01522"></a>01522 {
<a name="l01523"></a>01523     <span class="comment">//Extract info from a PNG file</span>
<a name="l01524"></a>01524     $f=fopen($file,<span class="stringliteral">&#39;rb&#39;</span>);
<a name="l01525"></a>01525     <span class="keywordflow">if</span>(!$f)
<a name="l01526"></a>01526         $this-&gt;Error(<span class="stringliteral">&#39;Can\&#39;t open image file: &#39;</span>.$file);
<a name="l01527"></a>01527     <span class="comment">//Check signature</span>
<a name="l01528"></a>01528     <span class="keywordflow">if</span>(fread($f,8)!=chr(137).<span class="stringliteral">&#39;PNG&#39;</span>.chr(13).chr(10).chr(26).chr(10))
<a name="l01529"></a>01529         $this-&gt;Error(<span class="stringliteral">&#39;Not a PNG file: &#39;</span>.$file);
<a name="l01530"></a>01530     <span class="comment">//Read header chunk</span>
<a name="l01531"></a>01531     fread($f,4);
<a name="l01532"></a>01532     <span class="keywordflow">if</span>(fread($f,4)!=<span class="stringliteral">&#39;IHDR&#39;</span>)
<a name="l01533"></a>01533         $this-&gt;Error(<span class="stringliteral">&#39;Incorrect PNG file: &#39;</span>.$file);
<a name="l01534"></a>01534     $w=$this-&gt;_freadint($f);
<a name="l01535"></a>01535     $h=$this-&gt;_freadint($f);
<a name="l01536"></a>01536     $bpc=ord(fread($f,1));
<a name="l01537"></a>01537     <span class="keywordflow">if</span>($bpc&gt;8)
<a name="l01538"></a>01538         $this-&gt;Error(<span class="stringliteral">&#39;16-bit depth not supported: &#39;</span>.$file);
<a name="l01539"></a>01539     $ct=ord(fread($f,1));
<a name="l01540"></a>01540     <span class="keywordflow">if</span>($ct==0)
<a name="l01541"></a>01541         $colspace=<span class="stringliteral">&#39;DeviceGray&#39;</span>;
<a name="l01542"></a>01542     elseif($ct==2)
<a name="l01543"></a>01543         $colspace=&#39;DeviceRGB&#39;;
<a name="l01544"></a>01544     elseif($ct==3)
<a name="l01545"></a>01545         $colspace=&#39;Indexed&#39;;
<a name="l01546"></a>01546     else
<a name="l01547"></a>01547         $this-&gt;Error(&#39;Alpha channel not supported: &#39;.$file);
<a name="l01548"></a>01548     <a class="code" href="admin__panel_8php.html#acdfe0026633f5372cbc1954f91109f30">if</a>(ord(fread($f,1))!=0)
<a name="l01549"></a>01549         $this-&gt;Error(&#39;Unknown compression method: &#39;.$file);
<a name="l01550"></a>01550     <a class="code" href="admin__panel_8php.html#acdfe0026633f5372cbc1954f91109f30">if</a>(ord(fread($f,1))!=0)
<a name="l01551"></a>01551         $this-&gt;Error(&#39;Unknown filter method: &#39;.$file);
<a name="l01552"></a>01552     <a class="code" href="admin__panel_8php.html#acdfe0026633f5372cbc1954f91109f30">if</a>(ord(fread($f,1))!=0)
<a name="l01553"></a>01553         $this-&gt;Error(&#39;Interlacing not supported: &#39;.$file);
<a name="l01554"></a>01554     fread($f,4);
<a name="l01555"></a>01555     $parms=&#39;/DecodeParms &lt;&lt;/Predictor 15 /Colors &#39;.($ct==2 ? 3 : 1).&#39; /BitsPerComponent &#39;.$bpc.&#39; /Columns &#39;.$w.&#39;&gt;&gt;&#39;;
<a name="l01556"></a>01556     <span class="comment">//Scan chunks looking for palette, transparency and image data</span>
<a name="l01557"></a>01557     $pal=&#39;&#39;;
<a name="l01558"></a>01558     $trns=&#39;&#39;;
<a name="l01559"></a>01559     $data=&#39;&#39;;
<a name="l01560"></a>01560     do
<a name="l01561"></a>01561     {
<a name="l01562"></a>01562         $n=$this-&gt;_freadint($f);
<a name="l01563"></a>01563         $type=fread($f,4);
<a name="l01564"></a>01564         <span class="keywordflow">if</span>($type==<span class="stringliteral">&#39;PLTE&#39;</span>)
<a name="l01565"></a>01565         {
<a name="l01566"></a>01566             <span class="comment">//Read palette</span>
<a name="l01567"></a>01567             $pal=fread($f,$n);
<a name="l01568"></a>01568             fread($f,4);
<a name="l01569"></a>01569         }
<a name="l01570"></a>01570         elseif($type==<span class="stringliteral">&#39;tRNS&#39;</span>)
<a name="l01571"></a>01571         {
<a name="l01572"></a>01572             <span class="comment">//Read transparency info</span>
<a name="l01573"></a>01573             $t=fread($f,$n);
<a name="l01574"></a>01574             <span class="keywordflow">if</span>($ct==0)
<a name="l01575"></a>01575                 $trns=array(ord(substr($t,1,1)));
<a name="l01576"></a>01576             elseif($ct==2)
<a name="l01577"></a>01577                 $trns=array(ord(substr($t,1,1)),ord(substr($t,3,1)),ord(substr($t,5,1)));
<a name="l01578"></a>01578             else
<a name="l01579"></a>01579             {
<a name="l01580"></a>01580                 $pos=strpos($t,chr(0));
<a name="l01581"></a>01581                 <span class="keywordflow">if</span>($pos!==<span class="keyword">false</span>)
<a name="l01582"></a>01582                     $trns=array($pos);
<a name="l01583"></a>01583             }
<a name="l01584"></a>01584             fread($f,4);
<a name="l01585"></a>01585         }
<a name="l01586"></a>01586         elseif($type==<span class="stringliteral">&#39;IDAT&#39;</span>)
<a name="l01587"></a>01587         {
<a name="l01588"></a>01588             <span class="comment">//Read image data block</span>
<a name="l01589"></a>01589             $data.=fread($f,$n);
<a name="l01590"></a>01590             fread($f,4);
<a name="l01591"></a>01591         }
<a name="l01592"></a>01592         elseif($type==<span class="stringliteral">&#39;IEND&#39;</span>)
<a name="l01593"></a>01593             break;
<a name="l01594"></a>01594         else
<a name="l01595"></a>01595             fread($f,$n+4);
<a name="l01596"></a>01596     }
<a name="l01597"></a>01597     while($n);
<a name="l01598"></a>01598     <a class="code" href="admin__panel_8php.html#acdfe0026633f5372cbc1954f91109f30">if</a>($colspace==&#39;Indexed&#39; &amp;&amp; empty($pal))
<a name="l01599"></a>01599         $this-&gt;Error(&#39;Missing palette in &#39;.$file);
<a name="l01600"></a>01600     fclose($f);
<a name="l01601"></a>01601     return array(&#39;w&#39;=&gt;$w,&#39;h&#39;=&gt;$h,&#39;cs&#39;=&gt;$colspace,&#39;bpc&#39;=&gt;$bpc,&#39;f&#39;=&gt;&#39;FlateDecode&#39;,&#39;parms&#39;=&gt;$parms,&#39;pal&#39;=&gt;$pal,&#39;trns&#39;=&gt;$trns,&#39;data&#39;=&gt;$data);
<a name="l01602"></a>01602 }
<a name="l01603"></a>01603 
<a name="l01604"></a>01604 function _freadint($f)
<a name="l01605"></a>01605 {
<a name="l01606"></a>01606     <span class="comment">//Read a 4-byte integer from file</span>
<a name="l01607"></a>01607     $a=unpack(<span class="stringliteral">&#39;Ni&#39;</span>,fread($f,4));
<a name="l01608"></a>01608     <span class="keywordflow">return</span> $a[<span class="charliteral">&#39;i&#39;</span>];
<a name="l01609"></a>01609 }
<a name="l01610"></a>01610 
<a name="l01611"></a>01611 <span class="keyword">function</span> _textstring($s)
<a name="l01612"></a>01612 {
<a name="l01613"></a>01613     <span class="comment">//Format a text string</span>
<a name="l01614"></a>01614     <span class="keywordflow">return</span> <span class="charliteral">&#39;(&#39;</span>.$this-&gt;_escape($s).<span class="charliteral">&#39;)&#39;</span>;
<a name="l01615"></a>01615 }
<a name="l01616"></a>01616 
<a name="l01617"></a>01617 <span class="keyword">function</span> _escape($s)
<a name="l01618"></a>01618 {
<a name="l01619"></a>01619     <span class="comment">//Add \ before \, ( and )</span>
<a name="l01620"></a>01620     <span class="keywordflow">return</span> str_replace(<span class="charliteral">&#39;)&#39;</span>,<span class="stringliteral">&#39;\\)&#39;</span>,str_replace(<span class="charliteral">&#39;(&#39;</span>,<span class="stringliteral">&#39;\\(&#39;</span>,str_replace(<span class="charliteral">&#39;\\&#39;</span>,<span class="stringliteral">&#39;\\\\&#39;</span>,$s)));
<a name="l01621"></a>01621 }
<a name="l01622"></a>01622 
<a name="l01623"></a>01623 <span class="keyword">function</span> _putstream($s)
<a name="l01624"></a>01624 {
<a name="l01625"></a>01625     $this-&gt;_out(<span class="stringliteral">&#39;stream&#39;</span>);
<a name="l01626"></a>01626     $this-&gt;_out($s);
<a name="l01627"></a>01627     $this-&gt;_out(<span class="stringliteral">&#39;endstream&#39;</span>);
<a name="l01628"></a>01628 }
<a name="l01629"></a>01629 
<a name="l01630"></a>01630 <span class="keyword">function</span> _out($s)
<a name="l01631"></a>01631 {
<a name="l01632"></a>01632     <span class="comment">//Add a line to the document</span>
<a name="l01633"></a>01633     <span class="keywordflow">if</span>($this-&gt;state==2)
<a name="l01634"></a>01634         $this-&gt;pages[$this-&gt;page].=$s.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01635"></a>01635     <span class="keywordflow">else</span>
<a name="l01636"></a>01636         $this-&gt;buffer.=$s.<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l01637"></a>01637 }
<a name="l01638"></a>01638 <span class="comment">//End of class</span>
<a name="l01639"></a>01639 }
<a name="l01640"></a>01640 
<a name="l01641"></a>01641 <span class="comment">//Handle special IE contype request</span>
<a name="l01642"></a>01642 <span class="keywordflow">if</span>(isset($_SERVER[<span class="stringliteral">&#39;HTTP_USER_AGENT&#39;</span>]) &amp;&amp; $_SERVER[<span class="stringliteral">&#39;HTTP_USER_AGENT&#39;</span>]==<span class="stringliteral">&#39;contype&#39;</span>)
<a name="l01643"></a>01643 {
<a name="l01644"></a>01644     header(<span class="stringliteral">&#39;Content-Type: application/pdf&#39;</span>);
<a name="l01645"></a>01645     exit;
<a name="l01646"></a>01646 }
<a name="l01647"></a>01647 
<a name="l01648"></a>01648 }
<a name="l01649"></a>01649 ?&gt;
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>Tout</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Structures de données</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Fichiers</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Fonctions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Énumérations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Généré le Mardi Avril 14 2015 05:38:36 pour GaliDAV par &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
